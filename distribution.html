<!DOCTYPE html>
<html xmlns="http://www.w3.org/1999/xhtml" lang="en" xml:lang="en"><head>

<meta charset="utf-8">
<meta name="generator" content="quarto-1.2.313">

<meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=yes">


<title>rcounting - The Distribution of Counts or: How I Learned to Stop Worrying and Love Pandas Indexing</title>
<style>
code{white-space: pre-wrap;}
span.smallcaps{font-variant: small-caps;}
div.columns{display: flex; gap: min(4vw, 1.5em);}
div.column{flex: auto; overflow-x: auto;}
div.hanging-indent{margin-left: 1.5em; text-indent: -1.5em;}
ul.task-list{list-style: none;}
ul.task-list li input[type="checkbox"] {
  width: 0.8em;
  margin: 0 0.8em 0.2em -1.6em;
  vertical-align: middle;
}
pre > code.sourceCode { white-space: pre; position: relative; }
pre > code.sourceCode > span { display: inline-block; line-height: 1.25; }
pre > code.sourceCode > span:empty { height: 1.2em; }
.sourceCode { overflow: visible; }
code.sourceCode > span { color: inherit; text-decoration: inherit; }
div.sourceCode { margin: 1em 0; }
pre.sourceCode { margin: 0; }
@media screen {
div.sourceCode { overflow: auto; }
}
@media print {
pre > code.sourceCode { white-space: pre-wrap; }
pre > code.sourceCode > span { text-indent: -5em; padding-left: 5em; }
}
pre.numberSource code
  { counter-reset: source-line 0; }
pre.numberSource code > span
  { position: relative; left: -4em; counter-increment: source-line; }
pre.numberSource code > span > a:first-child::before
  { content: counter(source-line);
    position: relative; left: -1em; text-align: right; vertical-align: baseline;
    border: none; display: inline-block;
    -webkit-touch-callout: none; -webkit-user-select: none;
    -khtml-user-select: none; -moz-user-select: none;
    -ms-user-select: none; user-select: none;
    padding: 0 4px; width: 4em;
    color: #aaaaaa;
  }
pre.numberSource { margin-left: 3em; border-left: 1px solid #aaaaaa;  padding-left: 4px; }
div.sourceCode
  {   }
@media screen {
pre > code.sourceCode > span > a:first-child::before { text-decoration: underline; }
}
code span.al { color: #ff0000; font-weight: bold; } /* Alert */
code span.an { color: #60a0b0; font-weight: bold; font-style: italic; } /* Annotation */
code span.at { color: #7d9029; } /* Attribute */
code span.bn { color: #40a070; } /* BaseN */
code span.bu { color: #008000; } /* BuiltIn */
code span.cf { color: #007020; font-weight: bold; } /* ControlFlow */
code span.ch { color: #4070a0; } /* Char */
code span.cn { color: #880000; } /* Constant */
code span.co { color: #60a0b0; font-style: italic; } /* Comment */
code span.cv { color: #60a0b0; font-weight: bold; font-style: italic; } /* CommentVar */
code span.do { color: #ba2121; font-style: italic; } /* Documentation */
code span.dt { color: #902000; } /* DataType */
code span.dv { color: #40a070; } /* DecVal */
code span.er { color: #ff0000; font-weight: bold; } /* Error */
code span.ex { } /* Extension */
code span.fl { color: #40a070; } /* Float */
code span.fu { color: #06287e; } /* Function */
code span.im { color: #008000; font-weight: bold; } /* Import */
code span.in { color: #60a0b0; font-weight: bold; font-style: italic; } /* Information */
code span.kw { color: #007020; font-weight: bold; } /* Keyword */
code span.op { color: #666666; } /* Operator */
code span.ot { color: #007020; } /* Other */
code span.pp { color: #bc7a00; } /* Preprocessor */
code span.sc { color: #4070a0; } /* SpecialChar */
code span.ss { color: #bb6688; } /* SpecialString */
code span.st { color: #4070a0; } /* String */
code span.va { color: #19177c; } /* Variable */
code span.vs { color: #4070a0; } /* VerbatimString */
code span.wa { color: #60a0b0; font-weight: bold; font-style: italic; } /* Warning */
</style>


<script src="site_libs/quarto-nav/quarto-nav.js"></script>
<script src="site_libs/quarto-nav/headroom.min.js"></script>
<script src="site_libs/clipboard/clipboard.min.js"></script>
<script src="site_libs/quarto-search/autocomplete.umd.js"></script>
<script src="site_libs/quarto-search/fuse.min.js"></script>
<script src="site_libs/quarto-search/quarto-search.js"></script>
<meta name="quarto:offset" content="./">
<script src="site_libs/quarto-html/quarto.js"></script>
<script src="site_libs/quarto-html/popper.min.js"></script>
<script src="site_libs/quarto-html/tippy.umd.min.js"></script>
<script src="site_libs/quarto-html/anchor.min.js"></script>
<link href="site_libs/quarto-html/tippy.css" rel="stylesheet">
<link href="site_libs/quarto-html/quarto-syntax-highlighting.css" rel="stylesheet" class="quarto-color-scheme" id="quarto-text-highlighting-styles">
<link href="site_libs/quarto-html/quarto-syntax-highlighting-dark.css" rel="prefetch" class="quarto-color-scheme quarto-color-alternate" id="quarto-text-highlighting-styles">
<script src="site_libs/bootstrap/bootstrap.min.js"></script>
<link href="site_libs/bootstrap/bootstrap-icons.css" rel="stylesheet">
<link href="site_libs/bootstrap/bootstrap.min.css" rel="stylesheet" class="quarto-color-scheme" id="quarto-bootstrap" data-mode="light">
<link href="site_libs/bootstrap/bootstrap-dark.min.css" rel="prefetch" class="quarto-color-scheme quarto-color-alternate" id="quarto-bootstrap" data-mode="dark">
<script id="quarto-search-options" type="application/json">{
  "location": "sidebar",
  "copy-button": false,
  "collapse-after": 3,
  "panel-placement": "start",
  "type": "textbox",
  "limit": 20,
  "language": {
    "search-no-results-text": "No results",
    "search-matching-documents-text": "matching documents",
    "search-copy-link-title": "Copy link to search",
    "search-hide-matches-text": "Hide additional matches",
    "search-more-match-text": "more match in this document",
    "search-more-matches-text": "more matches in this document",
    "search-clear-button-title": "Clear",
    "search-detached-cancel-button-title": "Cancel",
    "search-submit-button-title": "Submit"
  }
}</script>

  <script src="https://cdn.jsdelivr.net/npm/mathjax@3/es5/tex-chtml-full.js" type="text/javascript"></script>

<link rel="stylesheet" href="styles.css">
</head>

<body class="nav-sidebar floating">

<div id="quarto-search-results"></div>
  <header id="quarto-header" class="headroom fixed-top">
  <nav class="quarto-secondary-nav" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar" aria-controls="quarto-sidebar" aria-expanded="false" aria-label="Toggle sidebar navigation" onclick="if (window.quartoToggleHeadroom) { window.quartoToggleHeadroom(); }">
    <div class="container-fluid d-flex justify-content-between">
      <h1 class="quarto-secondary-nav-title">The Distribution of Counts or: How I Learned to Stop Worrying and Love Pandas Indexing</h1>
      <button type="button" class="quarto-btn-toggle btn" aria-label="Show secondary navigation">
        <i class="bi bi-chevron-right"></i>
      </button>
    </div>
  </nav>
</header>
<!-- content -->
<div id="quarto-content" class="quarto-container page-columns page-rows-contents page-layout-article">
<!-- sidebar -->
  <nav id="quarto-sidebar" class="sidebar collapse sidebar-navigation floating overflow-auto">
    <div class="pt-lg-2 mt-2 text-left sidebar-header">
    <div class="sidebar-title mb-0 py-0">
      <a href="./">rcounting</a> 
        <div class="sidebar-tools-main">
  <a href="" class="quarto-color-scheme-toggle sidebar-tool" onclick="window.quartoToggleColorScheme(); return false;" title="Toggle dark mode"><i class="bi"></i></a>
</div>
    </div>
      </div>
    <div class="sidebar-menu-container"> 
    <ul class="list-unstyled mt-1">
        <li class="sidebar-item sidebar-item-section">
      <div class="sidebar-item-container"> 
            <a class="sidebar-item-text sidebar-link text-start" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar-section-1" aria-expanded="true">Analysis</a>
          <a class="sidebar-item-toggle text-start" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar-section-1" aria-expanded="true">
            <i class="bi bi-chevron-right ms-2"></i>
          </a> 
      </div>
      <ul id="quarto-sidebar-section-1" class="collapse list-unstyled sidebar-section depth1 show">  
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./index.html" class="sidebar-item-text sidebar-link">Analysing rcounting data</a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./separators.html" class="sidebar-item-text sidebar-link">The use of separators</a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./runs.html" class="sidebar-item-text sidebar-link">Longest runs</a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./network.html" class="sidebar-item-text sidebar-link">The r/counting network</a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./counting_counters.html" class="sidebar-item-text sidebar-link">Counting counters</a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./time.html" class="sidebar-item-text sidebar-link">Tick tock: looking at counting activity over time</a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./distribution.html" class="sidebar-item-text sidebar-link active">The Distribution of Counts or: How I Learned to Stop Worrying and Love Pandas Indexing</a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./dst.html" class="sidebar-item-text sidebar-link">Daylight Saving Time: On modelling and robustness</a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./side_threads.html" class="sidebar-item-text sidebar-link">All about side threads</a>
  </div>
</li>
      </ul>
  </li>
        <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./examples.html" class="sidebar-item-text sidebar-link">Examples</a>
  </div>
</li>
    </ul>
    </div>
</nav>
<!-- margin-sidebar -->
    <div id="quarto-margin-sidebar" class="sidebar margin-sidebar">
        <nav id="TOC" role="doc-toc" class="toc-active">
    <h2 id="toc-title">On this page</h2>
   
  <ul>
  <li><a href="#introduction" id="toc-introduction" class="nav-link active" data-scroll-target="#introduction">Introduction</a></li>
  <li><a href="#completion" id="toc-completion" class="nav-link" data-scroll-target="#completion">100% Completion</a></li>
  <li><a href="#efficient-getters" id="toc-efficient-getters" class="nav-link" data-scroll-target="#efficient-getters">Efficient getters</a></li>
  <li><a href="#the-overall-counting-distribution" id="toc-the-overall-counting-distribution" class="nav-link" data-scroll-target="#the-overall-counting-distribution">The Overall Counting Distribution</a></li>
  <li><a href="#odds-and-evens" id="toc-odds-and-evens" class="nav-link" data-scroll-target="#odds-and-evens">Odds and evens</a></li>
  </ul>
</nav>
    </div>
<!-- main -->
<main class="content" id="quarto-document-content">

<header id="title-block-header" class="quarto-title-block default">
<div class="quarto-title">
<div class="quarto-title-block"><div><h1 class="title d-none d-lg-block">The Distribution of Counts or: How I Learned to Stop Worrying and Love Pandas Indexing</h1><button type="button" class="btn code-tools-button dropdown-toggle" id="quarto-code-tools-menu" data-bs-toggle="dropdown" aria-expanded="false"><i class="bi"></i> Code</button><ul class="dropdown-menu dropdown-menu-end" aria-labelelledby="quarto-code-tools-menu"><li><a id="quarto-show-all-code" class="dropdown-item" href="javascript:void(0)" role="button">Show All Code</a></li><li><a id="quarto-hide-all-code" class="dropdown-item" href="javascript:void(0)" role="button">Hide All Code</a></li><li><hr class="dropdown-divider"></li><li><a id="quarto-view-source" class="dropdown-item" href="javascript:void(0)" role="button">View Source</a></li></ul></div></div>
</div>



<div class="quarto-title-meta">

    
  
    
  </div>
  

</header>

<section id="introduction" class="level1">
<h1>Introduction</h1>
<p>This round of analysis is a deep dive into the distribution of counts and counters, across the thousands of threads that have been posted on r/counting over the years. I’ll be trying to answer questions like “Which number from 1-1000” has been counted by the most people, and “Which people have a significant preference for counting odd or even numbers”.</p>
<p>We’ll start off with some code to import the relevant packages and load the data.</p>
<div class="cell" data-execution_count="1">
<details>
<summary>Code for importing packages and loading data</summary>
<div class="sourceCode cell-code" id="cb1"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb1-1"><a href="#cb1-1" aria-hidden="true" tabindex="-1"></a><span class="im">from</span> pathlib <span class="im">import</span> Path</span>
<span id="cb1-2"><a href="#cb1-2" aria-hidden="true" tabindex="-1"></a><span class="im">import</span> pandas <span class="im">as</span> pd</span>
<span id="cb1-3"><a href="#cb1-3" aria-hidden="true" tabindex="-1"></a><span class="im">import</span> sqlite3</span>
<span id="cb1-4"><a href="#cb1-4" aria-hidden="true" tabindex="-1"></a><span class="im">import</span> matplotlib.pyplot <span class="im">as</span> plt</span>
<span id="cb1-5"><a href="#cb1-5" aria-hidden="true" tabindex="-1"></a><span class="im">import</span> numpy <span class="im">as</span> np</span>
<span id="cb1-6"><a href="#cb1-6" aria-hidden="true" tabindex="-1"></a><span class="im">from</span> rcounting <span class="im">import</span> counters, analysis, graph_tools</span>
<span id="cb1-7"><a href="#cb1-7" aria-hidden="true" tabindex="-1"></a><span class="im">import</span> seaborn <span class="im">as</span> sns</span>
<span id="cb1-8"><a href="#cb1-8" aria-hidden="true" tabindex="-1"></a>sns.set_theme()</span>
<span id="cb1-9"><a href="#cb1-9" aria-hidden="true" tabindex="-1"></a><span class="im">from</span> IPython.display <span class="im">import</span> Markdown</span>
<span id="cb1-10"><a href="#cb1-10" aria-hidden="true" tabindex="-1"></a>data_directory <span class="op">=</span> Path(<span class="st">"../data"</span>)</span>
<span id="cb1-11"><a href="#cb1-11" aria-hidden="true" tabindex="-1"></a><span class="im">import</span> itertools</span>
<span id="cb1-12"><a href="#cb1-12" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb1-13"><a href="#cb1-13" aria-hidden="true" tabindex="-1"></a>db <span class="op">=</span> sqlite3.<span class="ex">connect</span>(data_directory <span class="op">/</span> <span class="st">"counting.sqlite"</span>)</span>
<span id="cb1-14"><a href="#cb1-14" aria-hidden="true" tabindex="-1"></a>counts <span class="op">=</span> pd.read_sql(<span class="st">"select username, submission_id, position from comments where position &gt; 0 order by timestamp"</span>, db)</span>
<span id="cb1-15"><a href="#cb1-15" aria-hidden="true" tabindex="-1"></a>counts[<span class="st">"username"</span>] <span class="op">=</span> counts[<span class="st">"username"</span>].<span class="bu">apply</span>(counters.apply_alias)</span>
<span id="cb1-16"><a href="#cb1-16" aria-hidden="true" tabindex="-1"></a>counts[<span class="st">"position"</span>] <span class="op">=</span> (counts[<span class="st">"position"</span>] <span class="op">-</span> <span class="dv">1</span>) <span class="op">%</span> <span class="dv">1000</span> <span class="op">+</span> <span class="dv">1</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
</div>
</section>
<section id="completion" class="level1">
<h1>100% Completion</h1>
<p>A natural place to start is to look at how many counters have counted every number from 1 to 1000. For this (and most of the other stats in this page) I’ll be restricting my attention to people who have made at least 1000 counts.</p>
<div class="cell" data-execution_count="2">
<details open="">
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb2"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb2-1"><a href="#cb2-1" aria-hidden="true" tabindex="-1"></a>totals <span class="op">=</span> counts.groupby(<span class="st">"username"</span>).size()</span>
<span id="cb2-2"><a href="#cb2-2" aria-hidden="true" tabindex="-1"></a>usernames <span class="op">=</span> [x <span class="cf">for</span> x <span class="kw">in</span> totals[totals <span class="op">&gt;=</span> <span class="dv">1000</span>].index <span class="cf">if</span> <span class="kw">not</span> counters.is_banned_counter(x)]</span>
<span id="cb2-3"><a href="#cb2-3" aria-hidden="true" tabindex="-1"></a>subset <span class="op">=</span> counts.query(<span class="st">"username in @usernames"</span>).copy()</span>
<span id="cb2-4"><a href="#cb2-4" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb2-5"><a href="#cb2-5" aria-hidden="true" tabindex="-1"></a>missing_values <span class="op">=</span> <span class="dv">1000</span> <span class="op">-</span> subset.groupby(<span class="st">"username"</span>)[<span class="st">"position"</span>].nunique()</span>
<span id="cb2-6"><a href="#cb2-6" aria-hidden="true" tabindex="-1"></a><span class="bu">sum</span>(missing_values <span class="op">==</span> <span class="dv">0</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output cell-output-display" data-execution_count="2">
<pre><code>80</code></pre>
</div>
</div>
<p>We can drill a little deeper and ask how quickly each counter reached the full set. In theory it’s possible to do that after only 1000 counts, but in practice it’s extremely unlikely. Indeed, <a href="#tbl-complete">Table&nbsp;1</a> shows that even the fastest counters needed multiple times that.</p>
<div class="cell" data-execution_count="3">
<details open="">
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb4"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb4-1"><a href="#cb4-1" aria-hidden="true" tabindex="-1"></a>completists <span class="op">=</span> [username <span class="cf">for</span> username <span class="kw">in</span> usernames <span class="cf">if</span> missing_values[username] <span class="op">==</span> <span class="dv">0</span>]</span>
<span id="cb4-2"><a href="#cb4-2" aria-hidden="true" tabindex="-1"></a>complete <span class="op">=</span> subset.query(<span class="st">"username in @completists"</span>).copy()</span>
<span id="cb4-3"><a href="#cb4-3" aria-hidden="true" tabindex="-1"></a>complete[<span class="st">"index"</span>] <span class="op">=</span> complete.index</span>
<span id="cb4-4"><a href="#cb4-4" aria-hidden="true" tabindex="-1"></a>last_counts <span class="op">=</span> complete.groupby(<span class="st">"username"</span>).<span class="bu">apply</span>(<span class="kw">lambda</span> x: (x.groupby(<span class="st">"position"</span>).head(<span class="dv">1</span>)).tail(<span class="dv">1</span>)[<span class="st">"index"</span>])</span>
<span id="cb4-5"><a href="#cb4-5" aria-hidden="true" tabindex="-1"></a>totals <span class="op">=</span> counts.groupby(<span class="st">"username"</span>).cumcount()</span>
<span id="cb4-6"><a href="#cb4-6" aria-hidden="true" tabindex="-1"></a>df <span class="op">=</span> (last_counts</span>
<span id="cb4-7"><a href="#cb4-7" aria-hidden="true" tabindex="-1"></a>      .reset_index(level<span class="op">=</span><span class="dv">1</span>)[<span class="st">"index"</span>]</span>
<span id="cb4-8"><a href="#cb4-8" aria-hidden="true" tabindex="-1"></a>      .<span class="bu">apply</span>(<span class="kw">lambda</span> x: totals.loc[x])</span>
<span id="cb4-9"><a href="#cb4-9" aria-hidden="true" tabindex="-1"></a>      .sort_values())</span>
<span id="cb4-10"><a href="#cb4-10" aria-hidden="true" tabindex="-1"></a>headers <span class="op">=</span> [<span class="st">"**Username**"</span>, <span class="st">"**Number of Counts**"</span>]</span>
<span id="cb4-11"><a href="#cb4-11" aria-hidden="true" tabindex="-1"></a>Markdown(pd.concat([df.tail().sort_values(ascending<span class="op">=</span><span class="va">False</span>), df.head()]).to_markdown(headers<span class="op">=</span>headers))</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output cell-output-display" data-execution_count="3">
<div id="tbl-complete" class="anchored">
<table class="table table-sm table-striped">
<caption>Table&nbsp;1: The fastest and slowest counters to count every number from 1 to 1000, according to how many counts they had when they reached the full sets</caption>
<thead>
<tr class="header">
<th style="text-align: left;"><strong>Username</strong></th>
<th style="text-align: right;"><strong>Number of Counts</strong></th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td style="text-align: left;">bluesolid</td>
<td style="text-align: right;">12272</td>
</tr>
<tr class="even">
<td style="text-align: left;">KingCaspianX</td>
<td style="text-align: right;">11706</td>
</tr>
<tr class="odd">
<td style="text-align: left;">Removedpixel</td>
<td style="text-align: right;">9979</td>
</tr>
<tr class="even">
<td style="text-align: left;">Smartstocks</td>
<td style="text-align: right;">9904</td>
</tr>
<tr class="odd">
<td style="text-align: left;">_zachhall</td>
<td style="text-align: right;">8993</td>
</tr>
<tr class="even">
<td style="text-align: left;">noduorg</td>
<td style="text-align: right;">2865</td>
</tr>
<tr class="odd">
<td style="text-align: left;">Countletics</td>
<td style="text-align: right;">2963</td>
</tr>
<tr class="even">
<td style="text-align: left;">MorallyGray</td>
<td style="text-align: right;">3606</td>
</tr>
<tr class="odd">
<td style="text-align: left;">Christmas_Missionary</td>
<td style="text-align: right;">3735</td>
</tr>
<tr class="even">
<td style="text-align: left;">Sharpeye468</td>
<td style="text-align: right;">3794</td>
</tr>
</tbody>
</table>
</div>
</div>
</div>
<p>Similarly, we can take a look at which counters are only missing a few values before they have the full set:</p>
<div class="cell" data-execution_count="4">
<details open="">
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb5"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb5-1"><a href="#cb5-1" aria-hidden="true" tabindex="-1"></a>missing <span class="op">=</span> [username <span class="cf">for</span> username <span class="kw">in</span> usernames <span class="cf">if</span> <span class="dv">0</span> <span class="op">&lt;</span> missing_values[username] <span class="op">&lt;=</span> <span class="dv">5</span>]</span>
<span id="cb5-2"><a href="#cb5-2" aria-hidden="true" tabindex="-1"></a>df <span class="op">=</span> (subset</span>
<span id="cb5-3"><a href="#cb5-3" aria-hidden="true" tabindex="-1"></a>      .query(<span class="st">"username in @missing"</span>)</span>
<span id="cb5-4"><a href="#cb5-4" aria-hidden="true" tabindex="-1"></a>      .groupby(<span class="st">"username"</span>)</span>
<span id="cb5-5"><a href="#cb5-5" aria-hidden="true" tabindex="-1"></a>      .size()</span>
<span id="cb5-6"><a href="#cb5-6" aria-hidden="true" tabindex="-1"></a>      .sort_values(ascending<span class="op">=</span><span class="va">False</span>)</span>
<span id="cb5-7"><a href="#cb5-7" aria-hidden="true" tabindex="-1"></a>      .to_frame(name<span class="op">=</span><span class="st">"n_counts"</span>))</span>
<span id="cb5-8"><a href="#cb5-8" aria-hidden="true" tabindex="-1"></a>df[<span class="st">"missing_value"</span>] <span class="op">=</span> (subset</span>
<span id="cb5-9"><a href="#cb5-9" aria-hidden="true" tabindex="-1"></a>                       .query(<span class="st">"username in @missing"</span>)</span>
<span id="cb5-10"><a href="#cb5-10" aria-hidden="true" tabindex="-1"></a>                       .groupby(<span class="st">"username"</span>)[<span class="st">"position"</span>]</span>
<span id="cb5-11"><a href="#cb5-11" aria-hidden="true" tabindex="-1"></a>                       .<span class="bu">apply</span>(<span class="kw">lambda</span> x: (<span class="bu">set</span>(<span class="bu">range</span>(<span class="dv">1</span>, <span class="dv">1001</span>)) <span class="op">-</span> <span class="bu">set</span>(x.unique()))))</span>
<span id="cb5-12"><a href="#cb5-12" aria-hidden="true" tabindex="-1"></a>headers <span class="op">=</span> [<span class="st">"**Username**"</span>, <span class="st">"**Total Counts**"</span>, <span class="st">"**Missing Values**"</span>]</span>
<span id="cb5-13"><a href="#cb5-13" aria-hidden="true" tabindex="-1"></a>Markdown(df.head(<span class="dv">10</span>).to_markdown(headers<span class="op">=</span>headers))</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output cell-output-display" data-execution_count="4">
<table class="table table-sm table-striped">
<caption>The 10 counters with the most counts who are still missing up to five values in order to have counted the full set of numbers from 1 to 1000 </caption>
<thead>
<tr class="header">
<th style="text-align: left;"><strong>Username</strong></th>
<th style="text-align: right;"><strong>Total Counts</strong></th>
<th style="text-align: left;"><strong>Missing Values</strong></th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td style="text-align: left;">whit4you</td>
<td style="text-align: right;">11663</td>
<td style="text-align: left;">{998}</td>
</tr>
<tr class="even">
<td style="text-align: left;">idunnowhy9000</td>
<td style="text-align: right;">10824</td>
<td style="text-align: left;">{952, 999}</td>
</tr>
<tr class="odd">
<td style="text-align: left;">949paintball</td>
<td style="text-align: right;">10611</td>
<td style="text-align: left;">{995, 991}</td>
</tr>
<tr class="even">
<td style="text-align: left;">MetArtScroll</td>
<td style="text-align: right;">9923</td>
<td style="text-align: left;">{56, 54}</td>
</tr>
<tr class="odd">
<td style="text-align: left;">Krazeli</td>
<td style="text-align: right;">8303</td>
<td style="text-align: left;">{280}</td>
</tr>
<tr class="even">
<td style="text-align: left;">basscrow</td>
<td style="text-align: right;">7416</td>
<td style="text-align: left;">{999}</td>
</tr>
<tr class="odd">
<td style="text-align: left;">Nekyiia</td>
<td style="text-align: right;">6706</td>
<td style="text-align: left;">{11, 5}</td>
</tr>
<tr class="even">
<td style="text-align: left;">gordonpt8</td>
<td style="text-align: right;">5953</td>
<td style="text-align: left;">{128}</td>
</tr>
<tr class="odd">
<td style="text-align: left;">teddymaniacc</td>
<td style="text-align: right;">5788</td>
<td style="text-align: left;">{379, 9, 11}</td>
</tr>
<tr class="even">
<td style="text-align: left;">cob331</td>
<td style="text-align: right;">5143</td>
<td style="text-align: left;">{1000}</td>
</tr>
</tbody>
</table>
</div>
</div>
</section>
<section id="efficient-getters" class="level1">
<h1>Efficient getters</h1>
<p>The counts on r/counting are organised in threads of 1000 counts, and getting the last count on a thread is a bit of a prize. Some counters are very motivated by gets, and some counters are less motivated by them, but everyone is aware of them.</p>
<p>On average, everyone should have made 1000 counts for each get they have, but some counters have ratios that are significantly different from that. We can look at which counters have made the fewest total counts but still managed to obtain a get</p>
<div class="cell" data-execution_count="5">
<details open="">
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb6"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb6-1"><a href="#cb6-1" aria-hidden="true" tabindex="-1"></a>getters <span class="op">=</span> counts.groupby(<span class="st">"submission_id"</span>).last()</span>
<span id="cb6-2"><a href="#cb6-2" aria-hidden="true" tabindex="-1"></a>gets <span class="op">=</span> getters.reset_index()[<span class="st">'username'</span>].value_counts()</span>
<span id="cb6-3"><a href="#cb6-3" aria-hidden="true" tabindex="-1"></a>gets.name <span class="op">=</span> <span class="st">"n_gets"</span></span>
<span id="cb6-4"><a href="#cb6-4" aria-hidden="true" tabindex="-1"></a>totals <span class="op">=</span> pd.concat([counts[<span class="st">'username'</span>].value_counts().loc[gets.index], gets], axis<span class="op">=</span><span class="dv">1</span>)</span>
<span id="cb6-5"><a href="#cb6-5" aria-hidden="true" tabindex="-1"></a>totals.columns <span class="op">=</span> [<span class="st">"counts"</span>, <span class="st">"gets"</span>]</span>
<span id="cb6-6"><a href="#cb6-6" aria-hidden="true" tabindex="-1"></a>headers <span class="op">=</span> [<span class="st">"**Username**"</span>, <span class="st">"**Counts**"</span>, <span class="st">"**Gets**"</span>]</span>
<span id="cb6-7"><a href="#cb6-7" aria-hidden="true" tabindex="-1"></a>Markdown(totals.sort_values(by<span class="op">=</span><span class="st">'counts'</span>).head().to_markdown(headers<span class="op">=</span>headers))</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output cell-output-display" data-execution_count="5">
<table class="table table-sm table-striped">
<caption>The counters with the fewest total number of counts who still have at least one get. </caption>
<thead>
<tr class="header">
<th style="text-align: left;"><strong>Username</strong></th>
<th style="text-align: right;"><strong>Counts</strong></th>
<th style="text-align: right;"><strong>Gets</strong></th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td style="text-align: left;">thephilsnipebar</td>
<td style="text-align: right;">1</td>
<td style="text-align: right;">1</td>
</tr>
<tr class="even">
<td style="text-align: left;">MeNowDealWithIt</td>
<td style="text-align: right;">1</td>
<td style="text-align: right;">1</td>
</tr>
<tr class="odd">
<td style="text-align: left;">Hotshot2k4</td>
<td style="text-align: right;">3</td>
<td style="text-align: right;">1</td>
</tr>
<tr class="even">
<td style="text-align: left;">Ralph_Schaosid</td>
<td style="text-align: right;">5</td>
<td style="text-align: right;">1</td>
</tr>
<tr class="odd">
<td style="text-align: left;">ItzTaken</td>
<td style="text-align: right;">5</td>
<td style="text-align: right;">1</td>
</tr>
</tbody>
</table>
</div>
</div>
<p>Looking at this list, <code class="verbatim">thephilsnipebar</code> and <code class="verbatim">Ralph_Schaosid</code> are immediately obvious as counting alts. <code class="verbatim">MeNowDealWithIt</code> has made significantly more than one count, but deleted their account before they were picked up by the script, so I have no idea how many. <code class="verbatim">Hotshot2k4</code> seems legit. They made three counts, the first of which was the 54k get. More recently, <code class="verbatim">ItzTaken</code> got a <a href="http://reddit.com/r/counting/comments/mlqtr1/_/gtobrvf?context=3">free get</a> that <code class="verbatim">VitaminB16</code> left in the 4195k thread. Before that they had made two counts in the 2M era.</p>
<div class="cell" data-execution_count="6">
<details open="">
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb7"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb7-1"><a href="#cb7-1" aria-hidden="true" tabindex="-1"></a>lt_100 <span class="op">=</span> (totals[<span class="st">"counts"</span>] <span class="op">&lt;</span> <span class="dv">100</span>).<span class="bu">sum</span>()</span>
<span id="cb7-2"><a href="#cb7-2" aria-hidden="true" tabindex="-1"></a>lt_1000 <span class="op">=</span> (totals[<span class="st">"counts"</span>] <span class="op">&lt;</span> <span class="dv">1000</span>).<span class="bu">sum</span>()</span>
<span id="cb7-3"><a href="#cb7-3" aria-hidden="true" tabindex="-1"></a>s <span class="op">=</span> (<span class="ss">f"All in all we have ~</span><span class="sc">{</span><span class="bu">round</span>(lt_100, <span class="op">-</span><span class="dv">1</span>)<span class="sc">}</span><span class="ss"> counters with a get and less than 100 total counts "</span></span>
<span id="cb7-4"><a href="#cb7-4" aria-hidden="true" tabindex="-1"></a>     <span class="ss">f"and ~</span><span class="sc">{</span><span class="bu">round</span>(lt_1000, <span class="op">-</span><span class="dv">1</span>)<span class="sc">}</span><span class="ss"> with less than 1000 counts. "</span></span>
<span id="cb7-5"><a href="#cb7-5" aria-hidden="true" tabindex="-1"></a>     <span class="st">"But again, there's a significant number of counts where I don't know the author, "</span></span>
<span id="cb7-6"><a href="#cb7-6" aria-hidden="true" tabindex="-1"></a>     <span class="st">"and a significant number of usernames that are unknown aliases."</span>)</span>
<span id="cb7-7"><a href="#cb7-7" aria-hidden="true" tabindex="-1"></a>Markdown(s)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output cell-output-display" data-execution_count="6">
<p>All in all we have ~30 counters with a get and less than 100 total counts and ~180 with less than 1000 counts. But again, there’s a significant number of counts where I don’t know the author, and a significant number of usernames that are unknown aliases.</p>
</div>
</div>
<p>Maybe it’s better instead to look only at counters who have made at least 1000 counts. The relevant comparison would then be the ratio of counts to gets. That’s shown on <a href="#tbl-ratio">Table&nbsp;2</a>, and veterans of r/counting will recognise some of the first five names as counters who like to try and snipe the get.</p>
<div class="cell" data-execution_count="7">
<details open="">
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb8"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb8-1"><a href="#cb8-1" aria-hidden="true" tabindex="-1"></a>totals <span class="op">=</span> totals.loc[totals[<span class="st">"counts"</span>] <span class="op">&gt;=</span> <span class="dv">1000</span>].copy()</span>
<span id="cb8-2"><a href="#cb8-2" aria-hidden="true" tabindex="-1"></a>totals[<span class="st">"ratio"</span>] <span class="op">=</span> totals[<span class="st">"counts"</span>] <span class="op">/</span> totals[<span class="st">"gets"</span>]</span>
<span id="cb8-3"><a href="#cb8-3" aria-hidden="true" tabindex="-1"></a>totals <span class="op">=</span> totals.sort_values(by<span class="op">=</span><span class="st">"ratio"</span>)</span>
<span id="cb8-4"><a href="#cb8-4" aria-hidden="true" tabindex="-1"></a>headers <span class="op">=</span> [<span class="st">"**Username**"</span>, <span class="st">"**Counts**"</span>, <span class="st">"**Gets**"</span>, <span class="st">"**Counts / Gets**"</span>]</span>
<span id="cb8-5"><a href="#cb8-5" aria-hidden="true" tabindex="-1"></a>Markdown(pd.concat([totals.head(), totals.tail()]).to_markdown(headers<span class="op">=</span>headers))</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output cell-output-display" data-execution_count="7">
<div id="tbl-ratio" class="anchored">
<table class="table table-sm table-striped">
<caption>Table&nbsp;2: The counters with at least 1000 counts who have the lowest and highest ratio of counts to gets.</caption>
<thead>
<tr class="header">
<th style="text-align: left;"><strong>Username</strong></th>
<th style="text-align: right;"><strong>Counts</strong></th>
<th style="text-align: right;"><strong>Gets</strong></th>
<th style="text-align: right;"><strong>Counts / Gets</strong></th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td style="text-align: left;">boxofkangaroos</td>
<td style="text-align: right;">3704</td>
<td style="text-align: right;">38</td>
<td style="text-align: right;">97.4737</td>
</tr>
<tr class="even">
<td style="text-align: left;">Maniac_34</td>
<td style="text-align: right;">10688</td>
<td style="text-align: right;">70</td>
<td style="text-align: right;">152.686</td>
</tr>
<tr class="odd">
<td style="text-align: left;">Damnified</td>
<td style="text-align: right;">1566</td>
<td style="text-align: right;">7</td>
<td style="text-align: right;">223.714</td>
</tr>
<tr class="even">
<td style="text-align: left;">Sharpeye468</td>
<td style="text-align: right;">6816</td>
<td style="text-align: right;">30</td>
<td style="text-align: right;">227.2</td>
</tr>
<tr class="odd">
<td style="text-align: left;">Unknow3n</td>
<td style="text-align: right;">1688</td>
<td style="text-align: right;">7</td>
<td style="text-align: right;">241.143</td>
</tr>
<tr class="even">
<td style="text-align: left;">a-username-for-me</td>
<td style="text-align: right;">10420</td>
<td style="text-align: right;">2</td>
<td style="text-align: right;">5210</td>
</tr>
<tr class="odd">
<td style="text-align: left;">idunnowhy9000</td>
<td style="text-align: right;">10824</td>
<td style="text-align: right;">2</td>
<td style="text-align: right;">5412</td>
</tr>
<tr class="even">
<td style="text-align: left;">zvrizdinus</td>
<td style="text-align: right;">5746</td>
<td style="text-align: right;">1</td>
<td style="text-align: right;">5746</td>
</tr>
<tr class="odd">
<td style="text-align: left;">whit4you</td>
<td style="text-align: right;">11663</td>
<td style="text-align: right;">2</td>
<td style="text-align: right;">5831.5</td>
</tr>
<tr class="even">
<td style="text-align: left;">949paintball</td>
<td style="text-align: right;">10611</td>
<td style="text-align: right;">1</td>
<td style="text-align: right;">10611</td>
</tr>
</tbody>
</table>
</div>
</div>
</div>
</section>
<section id="the-overall-counting-distribution" class="level1">
<h1>The Overall Counting Distribution</h1>
<p>I promised to write about a distribution of counts, and so far I’ve mainly written about what numbers individual counters have or have not counted. And there hasn’t been a single graph yet! But I promise that’s about to change. A fun thing to look at first is how many people have counted each number from 1 to 1000. It wouldn’t be far-fetched to assume that each number had been counted by roughly the same amount of people, but that’s not at all what happens. <a href="#fig-distribution">Figure&nbsp;1</a> has the details.</p>
<div class="cell" data-execution_count="8">
<details open="">
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb9"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb9-1"><a href="#cb9-1" aria-hidden="true" tabindex="-1"></a>aggregated <span class="op">=</span> counts.groupby(<span class="st">"position"</span>)[<span class="st">"username"</span>].nunique()</span>
<span id="cb9-2"><a href="#cb9-2" aria-hidden="true" tabindex="-1"></a>ax <span class="op">=</span> aggregated.iloc[<span class="dv">0</span>:<span class="dv">1000</span>].plot(ylabel<span class="op">=</span><span class="st">"Number of different counters"</span>, xlabel<span class="op">=</span><span class="st">"Thread position"</span>)</span>
<span id="cb9-3"><a href="#cb9-3" aria-hidden="true" tabindex="-1"></a>_ <span class="op">=</span> ax.set_xlim(<span class="op">-</span><span class="dv">5</span>, <span class="dv">1000</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output cell-output-display">
<div id="fig-distribution" class="quarto-figure quarto-figure-center anchored">
<figure class="figure">
<p><img src="distribution_files/figure-html/fig-distribution-output-1.png" width="620" height="436" class="figure-img"></p>
<p></p><figcaption class="figure-caption">Figure&nbsp;1: The amount of people who have counted each number. You can see a very sharp rise from the start of each thread to ~50, followed by a steady decline towards the get. The most popular number has been counted by more than twice as many people as the least popular.</figcaption><p></p>
</figure>
</div>
</div>
</div>
<p>We can also look at the counting distributions for individual counters. Again, the default assumption would be that everybody has counted each number roughly the same number of times. Not too surprisingly, we see that this assumption holds better for some counters than it does for others. <a href="#fig-regularity">Figure&nbsp;2</a> shows the counting distributions for the most and least regular counter, and you can really see the difference between the two.</p>
<p>The graph has been split into odds and evens, because there’s generally a consistent difference between those two series. Intuitively, that makes sense, since most counts are made in runs where a given user makes every second counts. It’s therefore not too strange that the behaviour at a value <span class="math inline">\(n\)</span> is more similar to that at <span class="math inline">\(n - 2\)</span> than at <span class="math inline">\(n - 1\)</span>.</p>
<div class="cell" data-execution_count="9">
<details open="">
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb10"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb10-1"><a href="#cb10-1" aria-hidden="true" tabindex="-1"></a>grouped <span class="op">=</span> complete[[<span class="st">'username'</span>, <span class="st">'position'</span>]].value_counts()</span>
<span id="cb10-2"><a href="#cb10-2" aria-hidden="true" tabindex="-1"></a>cov <span class="op">=</span> grouped.groupby(level<span class="op">=</span><span class="dv">0</span>).agg(<span class="kw">lambda</span> x: np.std(x) <span class="op">/</span> np.mean(x)).sort_values()</span>
<span id="cb10-3"><a href="#cb10-3" aria-hidden="true" tabindex="-1"></a>users <span class="op">=</span> [cov.index[<span class="dv">0</span>], cov.index[<span class="op">-</span><span class="dv">1</span>]]</span>
<span id="cb10-4"><a href="#cb10-4" aria-hidden="true" tabindex="-1"></a>data <span class="op">=</span> grouped.loc[users].sort_index().to_frame().reset_index()</span>
<span id="cb10-5"><a href="#cb10-5" aria-hidden="true" tabindex="-1"></a>data.columns <span class="op">=</span> [<span class="st">'Counter'</span>, <span class="st">'Thread Position'</span>, <span class="st">'count'</span>]</span>
<span id="cb10-6"><a href="#cb10-6" aria-hidden="true" tabindex="-1"></a>data.loc[data[<span class="st">"Counter"</span>] <span class="op">==</span> users[<span class="dv">0</span>], <span class="st">'count'</span>] <span class="op">/=</span> data.loc[data[<span class="st">"Counter"</span>] <span class="op">==</span> users[<span class="dv">0</span>], <span class="st">'count'</span>].mean()</span>
<span id="cb10-7"><a href="#cb10-7" aria-hidden="true" tabindex="-1"></a>data.loc[data[<span class="st">"Counter"</span>] <span class="op">==</span> users[<span class="dv">1</span>], <span class="st">'count'</span>] <span class="op">/=</span> data.loc[data[<span class="st">"Counter"</span>] <span class="op">==</span> users[<span class="dv">1</span>], <span class="st">'count'</span>].mean()</span>
<span id="cb10-8"><a href="#cb10-8" aria-hidden="true" tabindex="-1"></a>data[<span class="st">"Parity"</span>] <span class="op">=</span> [[<span class="st">"even"</span>, <span class="st">"odd"</span>][val] <span class="cf">for</span> val <span class="kw">in</span> data.index <span class="op">%</span> <span class="dv">2</span>]</span>
<span id="cb10-9"><a href="#cb10-9" aria-hidden="true" tabindex="-1"></a>ax <span class="op">=</span> sns.lineplot(data<span class="op">=</span>data, y<span class="op">=</span><span class="st">'count'</span>, x<span class="op">=</span><span class="st">"Thread Position"</span>, hue<span class="op">=</span><span class="st">"Parity"</span>, style<span class="op">=</span><span class="st">"Counter"</span>)</span>
<span id="cb10-10"><a href="#cb10-10" aria-hidden="true" tabindex="-1"></a>_ <span class="op">=</span> ax.set_ylabel(<span class="st">"Relative frequency"</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output cell-output-display">
<div id="fig-regularity" class="quarto-figure quarto-figure-center anchored">
<figure class="figure">
<p><img src="distribution_files/figure-html/fig-regularity-output-1.png" width="597" height="436" class="figure-img"></p>
<p></p><figcaption class="figure-caption">Figure&nbsp;2: The normalized number of counts made at each value for the most and least regular counters. If every number had been counted exactly the same amount of times, there would be a flat line at y=1</figcaption><p></p>
</figure>
</div>
</div>
</div>
<p>We can quantify the difference for each counter through the <a href="https://en.wikipedia.org/wiki/Coefficient_of_variation">Coefficient of Variation</a>, which expresses how far their counting distribution is from uniform. Here’s a table of the five most and five least regular counters:</p>
<div class="cell" data-execution_count="10">
<details open="">
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb11"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb11-1"><a href="#cb11-1" aria-hidden="true" tabindex="-1"></a>Markdown(pd.concat([<span class="dv">100</span><span class="op">*</span>cov.head(), <span class="dv">100</span><span class="op">*</span>cov.tail()])</span>
<span id="cb11-2"><a href="#cb11-2" aria-hidden="true" tabindex="-1"></a>         .to_markdown(headers<span class="op">=</span>[<span class="st">"**Username**"</span>, <span class="st">"**Coefficient of Variation [%]**"</span>]))</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output cell-output-display" data-execution_count="10">
<table class="table table-sm table-striped">
<thead>
<tr class="header">
<th style="text-align: left;"><strong>Username</strong></th>
<th style="text-align: right;"><strong>Coefficient of Variation [%]</strong></th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td style="text-align: left;">Countletics</td>
<td style="text-align: right;">9.41016</td>
</tr>
<tr class="even">
<td style="text-align: left;">Ezekiel134</td>
<td style="text-align: right;">9.58323</td>
</tr>
<tr class="odd">
<td style="text-align: left;">RandomRedditorWithNo</td>
<td style="text-align: right;">9.90369</td>
</tr>
<tr class="even">
<td style="text-align: left;">Antichess</td>
<td style="text-align: right;">9.90815</td>
</tr>
<tr class="odd">
<td style="text-align: left;">atomicimploder</td>
<td style="text-align: right;">10.3837</td>
</tr>
<tr class="even">
<td style="text-align: left;">a-username-for-me</td>
<td style="text-align: right;">46.2564</td>
</tr>
<tr class="odd">
<td style="text-align: left;">ThreeDomeHome</td>
<td style="text-align: right;">48.1319</td>
</tr>
<tr class="even">
<td style="text-align: left;">bluesolid</td>
<td style="text-align: right;">51.7566</td>
</tr>
<tr class="odd">
<td style="text-align: left;">_zachhall</td>
<td style="text-align: right;">51.9715</td>
</tr>
<tr class="even">
<td style="text-align: left;">mistyskye14</td>
<td style="text-align: right;">55.9725</td>
</tr>
</tbody>
</table>
</div>
</div>
<p>Of course, we saw from <a href="#fig-distribution">Figure&nbsp;1</a> that there’s a significant variation in how many people have counted each number, so perhaps the uniform distribution is a bad model for how often we should expect each counter to have counted a particular number. Indeed, since twice as many people have counted the number 50 as have counted 1000, then <strong>on average</strong> people who have counted 1000 have done so twice as often as people who have counted 50. That leads to a model distribution that goes as <span class="math inline">\(f(n) \propto \frac{1}{\textrm{number of people who have counted n}}\)</span>. We can again look through all the counters and see who has a counting distribution closest to this ideal:</p>
<div class="cell" data-execution_count="11">
<details open="">
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb12"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb12-1"><a href="#cb12-1" aria-hidden="true" tabindex="-1"></a>distribution <span class="op">=</span> <span class="dv">1</span> <span class="op">/</span> aggregated.iloc[<span class="dv">0</span>:<span class="dv">1000</span>]</span>
<span id="cb12-2"><a href="#cb12-2" aria-hidden="true" tabindex="-1"></a>distribution <span class="op">=</span> distribution <span class="op">/</span> distribution.mean()</span>
<span id="cb12-3"><a href="#cb12-3" aria-hidden="true" tabindex="-1"></a>l2 <span class="op">=</span> (complete[[<span class="st">"username"</span>, <span class="st">"position"</span>]]</span>
<span id="cb12-4"><a href="#cb12-4" aria-hidden="true" tabindex="-1"></a>      .value_counts()</span>
<span id="cb12-5"><a href="#cb12-5" aria-hidden="true" tabindex="-1"></a>      .groupby(level<span class="op">=</span><span class="dv">0</span>)</span>
<span id="cb12-6"><a href="#cb12-6" aria-hidden="true" tabindex="-1"></a>      .agg(<span class="kw">lambda</span> x: ((x <span class="op">/</span> x.mean() <span class="op">-</span> distribution)<span class="op">**</span><span class="dv">2</span>).<span class="bu">sum</span>()))</span>
<span id="cb12-7"><a href="#cb12-7" aria-hidden="true" tabindex="-1"></a>username <span class="op">=</span> l2.sort_values().index[<span class="dv">0</span>]</span>
<span id="cb12-8"><a href="#cb12-8" aria-hidden="true" tabindex="-1"></a>data <span class="op">=</span> (complete[[<span class="st">'username'</span>, <span class="st">'position'</span>]]</span>
<span id="cb12-9"><a href="#cb12-9" aria-hidden="true" tabindex="-1"></a>        .value_counts()</span>
<span id="cb12-10"><a href="#cb12-10" aria-hidden="true" tabindex="-1"></a>        .loc[username]</span>
<span id="cb12-11"><a href="#cb12-11" aria-hidden="true" tabindex="-1"></a>        .sort_index()</span>
<span id="cb12-12"><a href="#cb12-12" aria-hidden="true" tabindex="-1"></a>        .to_frame()</span>
<span id="cb12-13"><a href="#cb12-13" aria-hidden="true" tabindex="-1"></a>        .reset_index())</span>
<span id="cb12-14"><a href="#cb12-14" aria-hidden="true" tabindex="-1"></a>data.columns <span class="op">=</span> [<span class="st">'Thread Position'</span>, <span class="st">'count'</span>]</span>
<span id="cb12-15"><a href="#cb12-15" aria-hidden="true" tabindex="-1"></a>data[<span class="st">'count'</span>] <span class="op">/=</span> data[<span class="st">'count'</span>].mean()</span>
<span id="cb12-16"><a href="#cb12-16" aria-hidden="true" tabindex="-1"></a>data[<span class="st">"Parity"</span>] <span class="op">=</span> [[<span class="st">"even"</span>, <span class="st">"odd"</span>][val] <span class="cf">for</span> val <span class="kw">in</span> data.index <span class="op">%</span> <span class="dv">2</span>]</span>
<span id="cb12-17"><a href="#cb12-17" aria-hidden="true" tabindex="-1"></a>ax <span class="op">=</span> sns.lineplot(data<span class="op">=</span>data, y<span class="op">=</span><span class="st">'count'</span>, x<span class="op">=</span><span class="st">"Thread Position"</span>, hue<span class="op">=</span><span class="st">"Parity"</span>, lw<span class="op">=</span><span class="dv">2</span>, linestyle<span class="op">=</span><span class="st">"--"</span>)</span>
<span id="cb12-18"><a href="#cb12-18" aria-hidden="true" tabindex="-1"></a>ax.plot(distribution, zorder<span class="op">=-</span><span class="dv">1</span>, color<span class="op">=</span><span class="st">"0.7"</span>)</span>
<span id="cb12-19"><a href="#cb12-19" aria-hidden="true" tabindex="-1"></a>ax.set_ylabel(<span class="st">"Relative Frequency"</span>)</span>
<span id="cb12-20"><a href="#cb12-20" aria-hidden="true" tabindex="-1"></a>_ <span class="op">=</span> ax.set_title(username)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output cell-output-display">
<div id="fig-model" class="quarto-figure quarto-figure-center anchored">
<figure class="figure">
<p><img src="distribution_files/figure-html/fig-model-output-1.png" width="606" height="456" class="figure-img"></p>
<p></p><figcaption class="figure-caption">Figure&nbsp;3: The distribution of counts for the counter who most closely matches the model distribution.</figcaption><p></p>
</figure>
</div>
</div>
</div>
<p>It’s impressive just how closely david’s counting frequency matches the toy model I suggested above!</p>
</section>
<section id="odds-and-evens" class="level1">
<h1>Odds and evens</h1>
<p>In the previous section we saw that for some counters, there’s a significant difference between how they’ve counted the odd numbers, and how they’ve counted the even numbers. The difference is not unexpected, since the nature of counting means that for any given run you’ll be stuck on either the odd numbers or the even numbers.</p>
<p>It is striking though just how large the difference can be for some counters, so here’s a table of the most odd counters, the most even counters and the most balanced counters:</p>
<div class="cell" data-execution_count="12">
<details open="">
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb13"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb13-1"><a href="#cb13-1" aria-hidden="true" tabindex="-1"></a>counts[<span class="st">"is_even"</span>] <span class="op">=</span> (counts[<span class="st">"position"</span>] <span class="op">%</span> <span class="dv">2</span> <span class="op">==</span> <span class="dv">0</span>)</span>
<span id="cb13-2"><a href="#cb13-2" aria-hidden="true" tabindex="-1"></a>offsets <span class="op">=</span> [<span class="st">"1gm10t"</span>, <span class="st">"7hn2tm"</span>, <span class="st">"b471wg"</span>, <span class="st">"bz6r0g"</span>, <span class="st">"d6pgni"</span>, <span class="st">"ebnh39"</span>, <span class="st">"grggc0"</span>, <span class="st">"oj50hj"</span>, <span class="st">"ob4a2h"</span>, <span class="st">"t81gug"</span>]</span>
<span id="cb13-3"><a href="#cb13-3" aria-hidden="true" tabindex="-1"></a><span class="cf">for</span> offset <span class="kw">in</span> offsets:</span>
<span id="cb13-4"><a href="#cb13-4" aria-hidden="true" tabindex="-1"></a>    counts.loc[counts[<span class="st">"submission_id"</span>] <span class="op">==</span> offset, <span class="st">'is_even'</span>] <span class="op">=</span> <span class="dv">1</span> <span class="op">-</span> counts.loc[counts[<span class="st">"submission_id"</span>] <span class="op">==</span> offset, <span class="st">'is_even'</span>]</span>
<span id="cb13-5"><a href="#cb13-5" aria-hidden="true" tabindex="-1"></a>counts[<span class="st">'is_odd'</span>] <span class="op">=</span> <span class="dv">1</span> <span class="op">-</span> counts[<span class="st">'is_even'</span>]</span>
<span id="cb13-6"><a href="#cb13-6" aria-hidden="true" tabindex="-1"></a>subset <span class="op">=</span> counts.query(<span class="st">"username in @usernames"</span>)</span>
<span id="cb13-7"><a href="#cb13-7" aria-hidden="true" tabindex="-1"></a>table <span class="op">=</span> subset[[<span class="st">'username'</span>, <span class="st">'is_even'</span>, <span class="st">'is_odd'</span>]].groupby(<span class="st">'username'</span>).<span class="bu">sum</span>()</span>
<span id="cb13-8"><a href="#cb13-8" aria-hidden="true" tabindex="-1"></a>table.columns<span class="op">=</span>[<span class="st">"n_even"</span>, <span class="st">"n_odd"</span>]</span>
<span id="cb13-9"><a href="#cb13-9" aria-hidden="true" tabindex="-1"></a>table[<span class="st">'difference'</span>] <span class="op">=</span> table[<span class="st">'n_even'</span>] <span class="op">-</span> table[<span class="st">'n_odd'</span>]</span>
<span id="cb13-10"><a href="#cb13-10" aria-hidden="true" tabindex="-1"></a>table[<span class="st">'relative_difference'</span>] <span class="op">=</span> (table[<span class="st">'n_even'</span>] <span class="op">-</span> table[<span class="st">'n_odd'</span>]) <span class="op">/</span> (table[<span class="st">'n_even'</span>] <span class="op">+</span> table[<span class="st">'n_odd'</span>]) <span class="op">*</span> <span class="dv">100</span></span>
<span id="cb13-11"><a href="#cb13-11" aria-hidden="true" tabindex="-1"></a>table[<span class="st">'absolute_difference'</span>] <span class="op">=</span> <span class="bu">abs</span>(table[<span class="st">'relative_difference'</span>])</span>
<span id="cb13-12"><a href="#cb13-12" aria-hidden="true" tabindex="-1"></a>headers<span class="op">=</span>[<span class="st">"**Username**"</span>, <span class="st">"**n_(even)**"</span>, <span class="st">"**n_(odd)**"</span>, <span class="st">"**Difference**"</span>, <span class="st">"**Relative Difference [%]**"</span>]</span>
<span id="cb13-13"><a href="#cb13-13" aria-hidden="true" tabindex="-1"></a>columns <span class="op">=</span> [<span class="st">'n_even'</span>, <span class="st">'n_odd'</span>, <span class="st">'difference'</span>, <span class="st">'relative_difference'</span>]</span>
<span id="cb13-14"><a href="#cb13-14" aria-hidden="true" tabindex="-1"></a>Markdown(pd.concat([table.sort_values(by<span class="op">=</span><span class="st">'difference'</span>).head(),</span>
<span id="cb13-15"><a href="#cb13-15" aria-hidden="true" tabindex="-1"></a>                    table.sort_values(by<span class="op">=</span><span class="st">'difference'</span>, ascending<span class="op">=</span><span class="va">False</span>).head(),</span>
<span id="cb13-16"><a href="#cb13-16" aria-hidden="true" tabindex="-1"></a>                    table.sort_values(by<span class="op">=</span><span class="st">'absolute_difference'</span>).head()])[columns]</span>
<span id="cb13-17"><a href="#cb13-17" aria-hidden="true" tabindex="-1"></a>         .to_markdown(headers<span class="op">=</span>headers))</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output cell-output-display" data-execution_count="12">
<div id="tbl-parity" class="anchored">
<table class="table table-sm table-striped">
<caption>Table&nbsp;3: Three sets of counters, organised by parity: Those with most odd counts, those with most even counts, and those who are closest to being perfectly balanced.</caption>
<colgroup>
<col style="width: 20%">
<col style="width: 15%">
<col style="width: 14%">
<col style="width: 17%">
<col style="width: 30%">
</colgroup>
<thead>
<tr class="header">
<th style="text-align: left;"><strong>Username</strong></th>
<th style="text-align: right;"><strong>n_(even)</strong></th>
<th style="text-align: right;"><strong>n_(odd)</strong></th>
<th style="text-align: right;"><strong>Difference</strong></th>
<th style="text-align: right;"><strong>Relative Difference [%]</strong></th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td style="text-align: left;">thephilsblogbar2</td>
<td style="text-align: right;">196661</td>
<td style="text-align: right;">246743</td>
<td style="text-align: right;">-50082</td>
<td style="text-align: right;">-11.2949</td>
</tr>
<tr class="even">
<td style="text-align: left;">Smartstocks</td>
<td style="text-align: right;">85516</td>
<td style="text-align: right;">116356</td>
<td style="text-align: right;">-30840</td>
<td style="text-align: right;">-15.277</td>
</tr>
<tr class="odd">
<td style="text-align: left;">Trial-Name</td>
<td style="text-align: right;">34744</td>
<td style="text-align: right;">47309</td>
<td style="text-align: right;">-12565</td>
<td style="text-align: right;">-15.3133</td>
</tr>
<tr class="even">
<td style="text-align: left;">rschaosid</td>
<td style="text-align: right;">19358</td>
<td style="text-align: right;">27815</td>
<td style="text-align: right;">-8457</td>
<td style="text-align: right;">-17.9276</td>
</tr>
<tr class="odd">
<td style="text-align: left;">colby6666</td>
<td style="text-align: right;">12448</td>
<td style="text-align: right;">20211</td>
<td style="text-align: right;">-7763</td>
<td style="text-align: right;">-23.7699</td>
</tr>
<tr class="even">
<td style="text-align: left;">GarlicoinAccount</td>
<td style="text-align: right;">113830</td>
<td style="text-align: right;">94681</td>
<td style="text-align: right;">19149</td>
<td style="text-align: right;">9.18369</td>
</tr>
<tr class="odd">
<td style="text-align: left;">Countletics</td>
<td style="text-align: right;">207496</td>
<td style="text-align: right;">188802</td>
<td style="text-align: right;">18694</td>
<td style="text-align: right;">4.71716</td>
</tr>
<tr class="even">
<td style="text-align: left;">LeMinerWithCheese</td>
<td style="text-align: right;">27467</td>
<td style="text-align: right;">13503</td>
<td style="text-align: right;">13964</td>
<td style="text-align: right;">34.0835</td>
</tr>
<tr class="odd">
<td style="text-align: left;">qwertylool</td>
<td style="text-align: right;">56823</td>
<td style="text-align: right;">47547</td>
<td style="text-align: right;">9276</td>
<td style="text-align: right;">8.88761</td>
</tr>
<tr class="even">
<td style="text-align: left;">ClockButTakeOutTheL</td>
<td style="text-align: right;">39636</td>
<td style="text-align: right;">33606</td>
<td style="text-align: right;">6030</td>
<td style="text-align: right;">8.23298</td>
</tr>
<tr class="odd">
<td style="text-align: left;">Ynax</td>
<td style="text-align: right;">7613</td>
<td style="text-align: right;">7615</td>
<td style="text-align: right;">-2</td>
<td style="text-align: right;">-0.0131337</td>
</tr>
<tr class="even">
<td style="text-align: left;">cob331</td>
<td style="text-align: right;">2572</td>
<td style="text-align: right;">2571</td>
<td style="text-align: right;">1</td>
<td style="text-align: right;">0.0194439</td>
</tr>
<tr class="odd">
<td style="text-align: left;">supersammy00</td>
<td style="text-align: right;">7886</td>
<td style="text-align: right;">7900</td>
<td style="text-align: right;">-14</td>
<td style="text-align: right;">-0.0886862</td>
</tr>
<tr class="even">
<td style="text-align: left;">nonsensy</td>
<td style="text-align: right;">85603</td>
<td style="text-align: right;">85441</td>
<td style="text-align: right;">162</td>
<td style="text-align: right;">0.0947125</td>
</tr>
<tr class="odd">
<td style="text-align: left;">animus777</td>
<td style="text-align: right;">819</td>
<td style="text-align: right;">817</td>
<td style="text-align: right;">2</td>
<td style="text-align: right;">0.122249</td>
</tr>
</tbody>
</table>
</div>
</div>
</div>
<p>That’s all for now!</p>


<!-- -->

</section>

</main> <!-- /main -->
<script id="quarto-html-after-body" type="application/javascript">
window.document.addEventListener("DOMContentLoaded", function (event) {
  const toggleBodyColorMode = (bsSheetEl) => {
    const mode = bsSheetEl.getAttribute("data-mode");
    const bodyEl = window.document.querySelector("body");
    if (mode === "dark") {
      bodyEl.classList.add("quarto-dark");
      bodyEl.classList.remove("quarto-light");
    } else {
      bodyEl.classList.add("quarto-light");
      bodyEl.classList.remove("quarto-dark");
    }
  }
  const toggleBodyColorPrimary = () => {
    const bsSheetEl = window.document.querySelector("link#quarto-bootstrap");
    if (bsSheetEl) {
      toggleBodyColorMode(bsSheetEl);
    }
  }
  toggleBodyColorPrimary();  
  const disableStylesheet = (stylesheets) => {
    for (let i=0; i < stylesheets.length; i++) {
      const stylesheet = stylesheets[i];
      stylesheet.rel = 'prefetch';
    }
  }
  const enableStylesheet = (stylesheets) => {
    for (let i=0; i < stylesheets.length; i++) {
      const stylesheet = stylesheets[i];
      stylesheet.rel = 'stylesheet';
    }
  }
  const manageTransitions = (selector, allowTransitions) => {
    const els = window.document.querySelectorAll(selector);
    for (let i=0; i < els.length; i++) {
      const el = els[i];
      if (allowTransitions) {
        el.classList.remove('notransition');
      } else {
        el.classList.add('notransition');
      }
    }
  }
  const toggleColorMode = (alternate) => {
    // Switch the stylesheets
    const alternateStylesheets = window.document.querySelectorAll('link.quarto-color-scheme.quarto-color-alternate');
    manageTransitions('#quarto-margin-sidebar .nav-link', false);
    if (alternate) {
      enableStylesheet(alternateStylesheets);
      for (const sheetNode of alternateStylesheets) {
        if (sheetNode.id === "quarto-bootstrap") {
          toggleBodyColorMode(sheetNode);
        }
      }
    } else {
      disableStylesheet(alternateStylesheets);
      toggleBodyColorPrimary();
    }
    manageTransitions('#quarto-margin-sidebar .nav-link', true);
    // Switch the toggles
    const toggles = window.document.querySelectorAll('.quarto-color-scheme-toggle');
    for (let i=0; i < toggles.length; i++) {
      const toggle = toggles[i];
      if (toggle) {
        if (alternate) {
          toggle.classList.add("alternate");     
        } else {
          toggle.classList.remove("alternate");
        }
      }
    }
    // Hack to workaround the fact that safari doesn't
    // properly recolor the scrollbar when toggling (#1455)
    if (navigator.userAgent.indexOf('Safari') > 0 && navigator.userAgent.indexOf('Chrome') == -1) {
      manageTransitions("body", false);
      window.scrollTo(0, 1);
      setTimeout(() => {
        window.scrollTo(0, 0);
        manageTransitions("body", true);
      }, 40);  
    }
  }
  const isFileUrl = () => { 
    return window.location.protocol === 'file:';
  }
  const hasAlternateSentinel = () => {  
    let styleSentinel = getColorSchemeSentinel();
    if (styleSentinel !== null) {
      return styleSentinel === "alternate";
    } else {
      return false;
    }
  }
  const setStyleSentinel = (alternate) => {
    const value = alternate ? "alternate" : "default";
    if (!isFileUrl()) {
      window.localStorage.setItem("quarto-color-scheme", value);
    } else {
      localAlternateSentinel = value;
    }
  }
  const getColorSchemeSentinel = () => {
    if (!isFileUrl()) {
      const storageValue = window.localStorage.getItem("quarto-color-scheme");
      return storageValue != null ? storageValue : localAlternateSentinel;
    } else {
      return localAlternateSentinel;
    }
  }
  let localAlternateSentinel = 'default';
  // Dark / light mode switch
  window.quartoToggleColorScheme = () => {
    // Read the current dark / light value 
    let toAlternate = !hasAlternateSentinel();
    toggleColorMode(toAlternate);
    setStyleSentinel(toAlternate);
  };
  // Ensure there is a toggle, if there isn't float one in the top right
  if (window.document.querySelector('.quarto-color-scheme-toggle') === null) {
    const a = window.document.createElement('a');
    a.classList.add('top-right');
    a.classList.add('quarto-color-scheme-toggle');
    a.href = "";
    a.onclick = function() { try { window.quartoToggleColorScheme(); } catch {} return false; };
    const i = window.document.createElement("i");
    i.classList.add('bi');
    a.appendChild(i);
    window.document.body.appendChild(a);
  }
  // Switch to dark mode if need be
  if (hasAlternateSentinel()) {
    toggleColorMode(true);
  } else {
    toggleColorMode(false);
  }
  const icon = "";
  const anchorJS = new window.AnchorJS();
  anchorJS.options = {
    placement: 'right',
    icon: icon
  };
  anchorJS.add('.anchored');
  const clipboard = new window.ClipboardJS('.code-copy-button', {
    target: function(trigger) {
      return trigger.previousElementSibling;
    }
  });
  clipboard.on('success', function(e) {
    // button target
    const button = e.trigger;
    // don't keep focus
    button.blur();
    // flash "checked"
    button.classList.add('code-copy-button-checked');
    var currentTitle = button.getAttribute("title");
    button.setAttribute("title", "Copied!");
    let tooltip;
    if (window.bootstrap) {
      button.setAttribute("data-bs-toggle", "tooltip");
      button.setAttribute("data-bs-placement", "left");
      button.setAttribute("data-bs-title", "Copied!");
      tooltip = new bootstrap.Tooltip(button, 
        { trigger: "manual", 
          customClass: "code-copy-button-tooltip",
          offset: [0, -8]});
      tooltip.show();    
    }
    setTimeout(function() {
      if (tooltip) {
        tooltip.hide();
        button.removeAttribute("data-bs-title");
        button.removeAttribute("data-bs-toggle");
        button.removeAttribute("data-bs-placement");
      }
      button.setAttribute("title", currentTitle);
      button.classList.remove('code-copy-button-checked');
    }, 1000);
    // clear code selection
    e.clearSelection();
  });
  const viewSource = window.document.getElementById('quarto-view-source') ||
                     window.document.getElementById('quarto-code-tools-source');
  if (viewSource) {
    const sourceUrl = viewSource.getAttribute("data-quarto-source-url");
    viewSource.addEventListener("click", function(e) {
      if (sourceUrl) {
        // rstudio viewer pane
        if (/\bcapabilities=\b/.test(window.location)) {
          window.open(sourceUrl);
        } else {
          window.location.href = sourceUrl;
        }
      } else {
        const modal = new bootstrap.Modal(document.getElementById('quarto-embedded-source-code-modal'));
        modal.show();
      }
      return false;
    });
  }
  function toggleCodeHandler(show) {
    return function(e) {
      const detailsSrc = window.document.querySelectorAll(".cell > details > .sourceCode");
      for (let i=0; i<detailsSrc.length; i++) {
        const details = detailsSrc[i].parentElement;
        if (show) {
          details.open = true;
        } else {
          details.removeAttribute("open");
        }
      }
      const cellCodeDivs = window.document.querySelectorAll(".cell > .sourceCode");
      const fromCls = show ? "hidden" : "unhidden";
      const toCls = show ? "unhidden" : "hidden";
      for (let i=0; i<cellCodeDivs.length; i++) {
        const codeDiv = cellCodeDivs[i];
        if (codeDiv.classList.contains(fromCls)) {
          codeDiv.classList.remove(fromCls);
          codeDiv.classList.add(toCls);
        } 
      }
      return false;
    }
  }
  const hideAllCode = window.document.getElementById("quarto-hide-all-code");
  if (hideAllCode) {
    hideAllCode.addEventListener("click", toggleCodeHandler(false));
  }
  const showAllCode = window.document.getElementById("quarto-show-all-code");
  if (showAllCode) {
    showAllCode.addEventListener("click", toggleCodeHandler(true));
  }
  function tippyHover(el, contentFn) {
    const config = {
      allowHTML: true,
      content: contentFn,
      maxWidth: 500,
      delay: 100,
      arrow: false,
      appendTo: function(el) {
          return el.parentElement;
      },
      interactive: true,
      interactiveBorder: 10,
      theme: 'quarto',
      placement: 'bottom-start'
    };
    window.tippy(el, config); 
  }
  const noterefs = window.document.querySelectorAll('a[role="doc-noteref"]');
  for (var i=0; i<noterefs.length; i++) {
    const ref = noterefs[i];
    tippyHover(ref, function() {
      // use id or data attribute instead here
      let href = ref.getAttribute('data-footnote-href') || ref.getAttribute('href');
      try { href = new URL(href).hash; } catch {}
      const id = href.replace(/^#\/?/, "");
      const note = window.document.getElementById(id);
      return note.innerHTML;
    });
  }
  const findCites = (el) => {
    const parentEl = el.parentElement;
    if (parentEl) {
      const cites = parentEl.dataset.cites;
      if (cites) {
        return {
          el,
          cites: cites.split(' ')
        };
      } else {
        return findCites(el.parentElement)
      }
    } else {
      return undefined;
    }
  };
  var bibliorefs = window.document.querySelectorAll('a[role="doc-biblioref"]');
  for (var i=0; i<bibliorefs.length; i++) {
    const ref = bibliorefs[i];
    const citeInfo = findCites(ref);
    if (citeInfo) {
      tippyHover(citeInfo.el, function() {
        var popup = window.document.createElement('div');
        citeInfo.cites.forEach(function(cite) {
          var citeDiv = window.document.createElement('div');
          citeDiv.classList.add('hanging-indent');
          citeDiv.classList.add('csl-entry');
          var biblioDiv = window.document.getElementById('ref-' + cite);
          if (biblioDiv) {
            citeDiv.innerHTML = biblioDiv.innerHTML;
          }
          popup.appendChild(citeDiv);
        });
        return popup.innerHTML;
      });
    }
  }
});
</script><div class="modal fade" id="quarto-embedded-source-code-modal" tabindex="-1" aria-labelledby="quarto-embedded-source-code-modal-label" aria-hidden="true"><div class="modal-dialog modal-dialog-scrollable"><div class="modal-content"><div class="modal-header"><h5 class="modal-title" id="quarto-embedded-source-code-modal-label">Source Code</h5><button class="btn-close" data-bs-dismiss="modal"></button></div><div class="modal-body"><div class="">
<div class="sourceCode" id="cb14" data-shortcodes="false"><pre class="sourceCode markdown code-with-copy"><code class="sourceCode markdown"><span id="cb14-1"><a href="#cb14-1" aria-hidden="true" tabindex="-1"></a><span class="co">---</span></span>
<span id="cb14-2"><a href="#cb14-2" aria-hidden="true" tabindex="-1"></a><span class="an">title:</span><span class="co"> "The Distribution of Counts or: How I Learned to Stop Worrying and Love Pandas Indexing"</span></span>
<span id="cb14-3"><a href="#cb14-3" aria-hidden="true" tabindex="-1"></a><span class="co">---</span></span>
<span id="cb14-4"><a href="#cb14-4" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb14-5"><a href="#cb14-5" aria-hidden="true" tabindex="-1"></a><span class="fu"># Introduction</span></span>
<span id="cb14-6"><a href="#cb14-6" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb14-7"><a href="#cb14-7" aria-hidden="true" tabindex="-1"></a>This round of analysis is a deep dive into the distribution of counts and counters, across the thousands of threads that have been posted on r/counting over the years. I'll be trying to answer questions like "Which number from 1-1000" has been counted by the most people, and "Which people have a significant preference for counting odd or even numbers".</span>
<span id="cb14-8"><a href="#cb14-8" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb14-9"><a href="#cb14-9" aria-hidden="true" tabindex="-1"></a>We'll start off with some code to import the relevant packages and load the data.</span>
<span id="cb14-10"><a href="#cb14-10" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb14-13"><a href="#cb14-13" aria-hidden="true" tabindex="-1"></a><span class="in">```{python}</span></span>
<span id="cb14-14"><a href="#cb14-14" aria-hidden="true" tabindex="-1"></a><span class="co">#| code-fold: true</span></span>
<span id="cb14-15"><a href="#cb14-15" aria-hidden="true" tabindex="-1"></a><span class="co">#| code-summary: "Code for importing packages and loading data"</span></span>
<span id="cb14-16"><a href="#cb14-16" aria-hidden="true" tabindex="-1"></a><span class="im">from</span> pathlib <span class="im">import</span> Path</span>
<span id="cb14-17"><a href="#cb14-17" aria-hidden="true" tabindex="-1"></a><span class="im">import</span> pandas <span class="im">as</span> pd</span>
<span id="cb14-18"><a href="#cb14-18" aria-hidden="true" tabindex="-1"></a><span class="im">import</span> sqlite3</span>
<span id="cb14-19"><a href="#cb14-19" aria-hidden="true" tabindex="-1"></a><span class="im">import</span> matplotlib.pyplot <span class="im">as</span> plt</span>
<span id="cb14-20"><a href="#cb14-20" aria-hidden="true" tabindex="-1"></a><span class="im">import</span> numpy <span class="im">as</span> np</span>
<span id="cb14-21"><a href="#cb14-21" aria-hidden="true" tabindex="-1"></a><span class="im">from</span> rcounting <span class="im">import</span> counters, analysis, graph_tools</span>
<span id="cb14-22"><a href="#cb14-22" aria-hidden="true" tabindex="-1"></a><span class="im">import</span> seaborn <span class="im">as</span> sns</span>
<span id="cb14-23"><a href="#cb14-23" aria-hidden="true" tabindex="-1"></a>sns.set_theme()</span>
<span id="cb14-24"><a href="#cb14-24" aria-hidden="true" tabindex="-1"></a><span class="im">from</span> IPython.display <span class="im">import</span> Markdown</span>
<span id="cb14-25"><a href="#cb14-25" aria-hidden="true" tabindex="-1"></a>data_directory <span class="op">=</span> Path(<span class="st">"../data"</span>)</span>
<span id="cb14-26"><a href="#cb14-26" aria-hidden="true" tabindex="-1"></a><span class="im">import</span> itertools</span>
<span id="cb14-27"><a href="#cb14-27" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb14-28"><a href="#cb14-28" aria-hidden="true" tabindex="-1"></a>db <span class="op">=</span> sqlite3.<span class="ex">connect</span>(data_directory <span class="op">/</span> <span class="st">"counting.sqlite"</span>)</span>
<span id="cb14-29"><a href="#cb14-29" aria-hidden="true" tabindex="-1"></a>counts <span class="op">=</span> pd.read_sql(<span class="st">"select username, submission_id, position from comments where position &gt; 0 order by timestamp"</span>, db)</span>
<span id="cb14-30"><a href="#cb14-30" aria-hidden="true" tabindex="-1"></a>counts[<span class="st">"username"</span>] <span class="op">=</span> counts[<span class="st">"username"</span>].<span class="bu">apply</span>(counters.apply_alias)</span>
<span id="cb14-31"><a href="#cb14-31" aria-hidden="true" tabindex="-1"></a>counts[<span class="st">"position"</span>] <span class="op">=</span> (counts[<span class="st">"position"</span>] <span class="op">-</span> <span class="dv">1</span>) <span class="op">%</span> <span class="dv">1000</span> <span class="op">+</span> <span class="dv">1</span></span>
<span id="cb14-32"><a href="#cb14-32" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb14-33"><a href="#cb14-33" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb14-34"><a href="#cb14-34" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb14-35"><a href="#cb14-35" aria-hidden="true" tabindex="-1"></a><span class="fu"># 100% Completion</span></span>
<span id="cb14-36"><a href="#cb14-36" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb14-37"><a href="#cb14-37" aria-hidden="true" tabindex="-1"></a>A natural place to start is to look at how many counters have counted every number from 1 to 1000. For this (and most of the other stats in this page) I'll be restricting my attention to people who have made at least 1000 counts.</span>
<span id="cb14-38"><a href="#cb14-38" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb14-41"><a href="#cb14-41" aria-hidden="true" tabindex="-1"></a><span class="in">```{python}</span></span>
<span id="cb14-42"><a href="#cb14-42" aria-hidden="true" tabindex="-1"></a>totals <span class="op">=</span> counts.groupby(<span class="st">"username"</span>).size()</span>
<span id="cb14-43"><a href="#cb14-43" aria-hidden="true" tabindex="-1"></a>usernames <span class="op">=</span> [x <span class="cf">for</span> x <span class="kw">in</span> totals[totals <span class="op">&gt;=</span> <span class="dv">1000</span>].index <span class="cf">if</span> <span class="kw">not</span> counters.is_banned_counter(x)]</span>
<span id="cb14-44"><a href="#cb14-44" aria-hidden="true" tabindex="-1"></a>subset <span class="op">=</span> counts.query(<span class="st">"username in @usernames"</span>).copy()</span>
<span id="cb14-45"><a href="#cb14-45" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb14-46"><a href="#cb14-46" aria-hidden="true" tabindex="-1"></a>missing_values <span class="op">=</span> <span class="dv">1000</span> <span class="op">-</span> subset.groupby(<span class="st">"username"</span>)[<span class="st">"position"</span>].nunique()</span>
<span id="cb14-47"><a href="#cb14-47" aria-hidden="true" tabindex="-1"></a><span class="bu">sum</span>(missing_values <span class="op">==</span> <span class="dv">0</span>)</span>
<span id="cb14-48"><a href="#cb14-48" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb14-49"><a href="#cb14-49" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb14-50"><a href="#cb14-50" aria-hidden="true" tabindex="-1"></a>We can drill a little deeper and ask how quickly each counter reached the full set. In theory it's possible to do that after only 1000 counts, but in practice it's extremely unlikely. Indeed, @tbl-complete shows that even the fastest counters needed multiple times that.</span>
<span id="cb14-51"><a href="#cb14-51" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb14-54"><a href="#cb14-54" aria-hidden="true" tabindex="-1"></a><span class="in">```{python}</span></span>
<span id="cb14-55"><a href="#cb14-55" aria-hidden="true" tabindex="-1"></a><span class="co">#| label: tbl-complete</span></span>
<span id="cb14-56"><a href="#cb14-56" aria-hidden="true" tabindex="-1"></a><span class="co">#| tbl-cap: The fastest and slowest counters to count every number from 1 to 1000, according to how many counts they had when they reached the full sets</span></span>
<span id="cb14-57"><a href="#cb14-57" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb14-58"><a href="#cb14-58" aria-hidden="true" tabindex="-1"></a>completists <span class="op">=</span> [username <span class="cf">for</span> username <span class="kw">in</span> usernames <span class="cf">if</span> missing_values[username] <span class="op">==</span> <span class="dv">0</span>]</span>
<span id="cb14-59"><a href="#cb14-59" aria-hidden="true" tabindex="-1"></a>complete <span class="op">=</span> subset.query(<span class="st">"username in @completists"</span>).copy()</span>
<span id="cb14-60"><a href="#cb14-60" aria-hidden="true" tabindex="-1"></a>complete[<span class="st">"index"</span>] <span class="op">=</span> complete.index</span>
<span id="cb14-61"><a href="#cb14-61" aria-hidden="true" tabindex="-1"></a>last_counts <span class="op">=</span> complete.groupby(<span class="st">"username"</span>).<span class="bu">apply</span>(<span class="kw">lambda</span> x: (x.groupby(<span class="st">"position"</span>).head(<span class="dv">1</span>)).tail(<span class="dv">1</span>)[<span class="st">"index"</span>])</span>
<span id="cb14-62"><a href="#cb14-62" aria-hidden="true" tabindex="-1"></a>totals <span class="op">=</span> counts.groupby(<span class="st">"username"</span>).cumcount()</span>
<span id="cb14-63"><a href="#cb14-63" aria-hidden="true" tabindex="-1"></a>df <span class="op">=</span> (last_counts</span>
<span id="cb14-64"><a href="#cb14-64" aria-hidden="true" tabindex="-1"></a>      .reset_index(level<span class="op">=</span><span class="dv">1</span>)[<span class="st">"index"</span>]</span>
<span id="cb14-65"><a href="#cb14-65" aria-hidden="true" tabindex="-1"></a>      .<span class="bu">apply</span>(<span class="kw">lambda</span> x: totals.loc[x])</span>
<span id="cb14-66"><a href="#cb14-66" aria-hidden="true" tabindex="-1"></a>      .sort_values())</span>
<span id="cb14-67"><a href="#cb14-67" aria-hidden="true" tabindex="-1"></a>headers <span class="op">=</span> [<span class="st">"**Username**"</span>, <span class="st">"**Number of Counts**"</span>]</span>
<span id="cb14-68"><a href="#cb14-68" aria-hidden="true" tabindex="-1"></a>Markdown(pd.concat([df.tail().sort_values(ascending<span class="op">=</span><span class="va">False</span>), df.head()]).to_markdown(headers<span class="op">=</span>headers))</span>
<span id="cb14-69"><a href="#cb14-69" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb14-70"><a href="#cb14-70" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb14-71"><a href="#cb14-71" aria-hidden="true" tabindex="-1"></a>Similarly, we can take a look at which counters are only missing a few values before they have the full set:</span>
<span id="cb14-72"><a href="#cb14-72" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb14-75"><a href="#cb14-75" aria-hidden="true" tabindex="-1"></a><span class="in">```{python}</span></span>
<span id="cb14-76"><a href="#cb14-76" aria-hidden="true" tabindex="-1"></a><span class="co">#| tbl-cap: The 10 counters with the most counts who are still missing up to five values in order to have counted the full set of numbers from 1 to 1000</span></span>
<span id="cb14-77"><a href="#cb14-77" aria-hidden="true" tabindex="-1"></a>missing <span class="op">=</span> [username <span class="cf">for</span> username <span class="kw">in</span> usernames <span class="cf">if</span> <span class="dv">0</span> <span class="op">&lt;</span> missing_values[username] <span class="op">&lt;=</span> <span class="dv">5</span>]</span>
<span id="cb14-78"><a href="#cb14-78" aria-hidden="true" tabindex="-1"></a>df <span class="op">=</span> (subset</span>
<span id="cb14-79"><a href="#cb14-79" aria-hidden="true" tabindex="-1"></a>      .query(<span class="st">"username in @missing"</span>)</span>
<span id="cb14-80"><a href="#cb14-80" aria-hidden="true" tabindex="-1"></a>      .groupby(<span class="st">"username"</span>)</span>
<span id="cb14-81"><a href="#cb14-81" aria-hidden="true" tabindex="-1"></a>      .size()</span>
<span id="cb14-82"><a href="#cb14-82" aria-hidden="true" tabindex="-1"></a>      .sort_values(ascending<span class="op">=</span><span class="va">False</span>)</span>
<span id="cb14-83"><a href="#cb14-83" aria-hidden="true" tabindex="-1"></a>      .to_frame(name<span class="op">=</span><span class="st">"n_counts"</span>))</span>
<span id="cb14-84"><a href="#cb14-84" aria-hidden="true" tabindex="-1"></a>df[<span class="st">"missing_value"</span>] <span class="op">=</span> (subset</span>
<span id="cb14-85"><a href="#cb14-85" aria-hidden="true" tabindex="-1"></a>                       .query(<span class="st">"username in @missing"</span>)</span>
<span id="cb14-86"><a href="#cb14-86" aria-hidden="true" tabindex="-1"></a>                       .groupby(<span class="st">"username"</span>)[<span class="st">"position"</span>]</span>
<span id="cb14-87"><a href="#cb14-87" aria-hidden="true" tabindex="-1"></a>                       .<span class="bu">apply</span>(<span class="kw">lambda</span> x: (<span class="bu">set</span>(<span class="bu">range</span>(<span class="dv">1</span>, <span class="dv">1001</span>)) <span class="op">-</span> <span class="bu">set</span>(x.unique()))))</span>
<span id="cb14-88"><a href="#cb14-88" aria-hidden="true" tabindex="-1"></a>headers <span class="op">=</span> [<span class="st">"**Username**"</span>, <span class="st">"**Total Counts**"</span>, <span class="st">"**Missing Values**"</span>]</span>
<span id="cb14-89"><a href="#cb14-89" aria-hidden="true" tabindex="-1"></a>Markdown(df.head(<span class="dv">10</span>).to_markdown(headers<span class="op">=</span>headers))</span>
<span id="cb14-90"><a href="#cb14-90" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb14-91"><a href="#cb14-91" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb14-92"><a href="#cb14-92" aria-hidden="true" tabindex="-1"></a><span class="fu"># Efficient getters</span></span>
<span id="cb14-93"><a href="#cb14-93" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb14-94"><a href="#cb14-94" aria-hidden="true" tabindex="-1"></a>The counts on r/counting are organised in threads of 1000 counts, and getting the last count on a thread is a bit of a prize. Some counters are very motivated by gets, and some counters are less motivated by them, but everyone is aware of them.</span>
<span id="cb14-95"><a href="#cb14-95" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb14-96"><a href="#cb14-96" aria-hidden="true" tabindex="-1"></a>On average, everyone should have made 1000 counts for each get they have, but some counters have ratios that are significantly different from that. We can look at which counters have made the fewest total counts but still managed to obtain a get</span>
<span id="cb14-97"><a href="#cb14-97" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb14-100"><a href="#cb14-100" aria-hidden="true" tabindex="-1"></a><span class="in">```{python}</span></span>
<span id="cb14-101"><a href="#cb14-101" aria-hidden="true" tabindex="-1"></a><span class="co">#| tbl-cap: The counters with the fewest total number of counts who still have at least one get.</span></span>
<span id="cb14-102"><a href="#cb14-102" aria-hidden="true" tabindex="-1"></a>getters <span class="op">=</span> counts.groupby(<span class="st">"submission_id"</span>).last()</span>
<span id="cb14-103"><a href="#cb14-103" aria-hidden="true" tabindex="-1"></a>gets <span class="op">=</span> getters.reset_index()[<span class="st">'username'</span>].value_counts()</span>
<span id="cb14-104"><a href="#cb14-104" aria-hidden="true" tabindex="-1"></a>gets.name <span class="op">=</span> <span class="st">"n_gets"</span></span>
<span id="cb14-105"><a href="#cb14-105" aria-hidden="true" tabindex="-1"></a>totals <span class="op">=</span> pd.concat([counts[<span class="st">'username'</span>].value_counts().loc[gets.index], gets], axis<span class="op">=</span><span class="dv">1</span>)</span>
<span id="cb14-106"><a href="#cb14-106" aria-hidden="true" tabindex="-1"></a>totals.columns <span class="op">=</span> [<span class="st">"counts"</span>, <span class="st">"gets"</span>]</span>
<span id="cb14-107"><a href="#cb14-107" aria-hidden="true" tabindex="-1"></a>headers <span class="op">=</span> [<span class="st">"**Username**"</span>, <span class="st">"**Counts**"</span>, <span class="st">"**Gets**"</span>]</span>
<span id="cb14-108"><a href="#cb14-108" aria-hidden="true" tabindex="-1"></a>Markdown(totals.sort_values(by<span class="op">=</span><span class="st">'counts'</span>).head().to_markdown(headers<span class="op">=</span>headers))</span>
<span id="cb14-109"><a href="#cb14-109" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb14-110"><a href="#cb14-110" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb14-111"><a href="#cb14-111" aria-hidden="true" tabindex="-1"></a>Looking at this list, <span class="in">`thephilsnipebar`</span>{.verbatim} and <span class="in">`Ralph_Schaosid`</span>{.verbatim} are immediately obvious as counting alts. <span class="in">`MeNowDealWithIt`</span>{.verbatim} has made significantly more than one count, but deleted their account before they were picked up by the script, so I have no idea how many. <span class="in">`Hotshot2k4`</span>{.verbatim} seems legit. They made three counts, the first of which was the 54k get. More recently, <span class="in">`ItzTaken`</span>{.verbatim} got a <span class="co">[</span><span class="ot">free get</span><span class="co">](http://reddit.com/r/counting/comments/mlqtr1/_/gtobrvf?context=3)</span> that <span class="in">`VitaminB16`</span>{.verbatim} left in the 4195k thread. Before that they had made two counts in the 2M era.</span>
<span id="cb14-112"><a href="#cb14-112" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb14-115"><a href="#cb14-115" aria-hidden="true" tabindex="-1"></a><span class="in">```{python}</span></span>
<span id="cb14-116"><a href="#cb14-116" aria-hidden="true" tabindex="-1"></a>lt_100 <span class="op">=</span> (totals[<span class="st">"counts"</span>] <span class="op">&lt;</span> <span class="dv">100</span>).<span class="bu">sum</span>()</span>
<span id="cb14-117"><a href="#cb14-117" aria-hidden="true" tabindex="-1"></a>lt_1000 <span class="op">=</span> (totals[<span class="st">"counts"</span>] <span class="op">&lt;</span> <span class="dv">1000</span>).<span class="bu">sum</span>()</span>
<span id="cb14-118"><a href="#cb14-118" aria-hidden="true" tabindex="-1"></a>s <span class="op">=</span> (<span class="ss">f"All in all we have ~</span><span class="sc">{</span><span class="bu">round</span>(lt_100, <span class="op">-</span><span class="dv">1</span>)<span class="sc">}</span><span class="ss"> counters with a get and less than 100 total counts "</span></span>
<span id="cb14-119"><a href="#cb14-119" aria-hidden="true" tabindex="-1"></a>     <span class="ss">f"and ~</span><span class="sc">{</span><span class="bu">round</span>(lt_1000, <span class="op">-</span><span class="dv">1</span>)<span class="sc">}</span><span class="ss"> with less than 1000 counts. "</span></span>
<span id="cb14-120"><a href="#cb14-120" aria-hidden="true" tabindex="-1"></a>     <span class="st">"But again, there's a significant number of counts where I don't know the author, "</span></span>
<span id="cb14-121"><a href="#cb14-121" aria-hidden="true" tabindex="-1"></a>     <span class="st">"and a significant number of usernames that are unknown aliases."</span>)</span>
<span id="cb14-122"><a href="#cb14-122" aria-hidden="true" tabindex="-1"></a>Markdown(s)</span>
<span id="cb14-123"><a href="#cb14-123" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb14-124"><a href="#cb14-124" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb14-125"><a href="#cb14-125" aria-hidden="true" tabindex="-1"></a>Maybe it's better instead to look only at counters who have made at least 1000 counts. The relevant comparison would then be the ratio of counts to gets. That's shown on @tbl-ratio, and veterans of r/counting will recognise some of the first five names as counters who like to try and snipe the get.</span>
<span id="cb14-126"><a href="#cb14-126" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb14-129"><a href="#cb14-129" aria-hidden="true" tabindex="-1"></a><span class="in">```{python}</span></span>
<span id="cb14-130"><a href="#cb14-130" aria-hidden="true" tabindex="-1"></a><span class="co">#| label: tbl-ratio</span></span>
<span id="cb14-131"><a href="#cb14-131" aria-hidden="true" tabindex="-1"></a><span class="co">#| tbl-cap: The counters with at least 1000 counts who have the lowest and highest ratio of counts to gets.</span></span>
<span id="cb14-132"><a href="#cb14-132" aria-hidden="true" tabindex="-1"></a>totals <span class="op">=</span> totals.loc[totals[<span class="st">"counts"</span>] <span class="op">&gt;=</span> <span class="dv">1000</span>].copy()</span>
<span id="cb14-133"><a href="#cb14-133" aria-hidden="true" tabindex="-1"></a>totals[<span class="st">"ratio"</span>] <span class="op">=</span> totals[<span class="st">"counts"</span>] <span class="op">/</span> totals[<span class="st">"gets"</span>]</span>
<span id="cb14-134"><a href="#cb14-134" aria-hidden="true" tabindex="-1"></a>totals <span class="op">=</span> totals.sort_values(by<span class="op">=</span><span class="st">"ratio"</span>)</span>
<span id="cb14-135"><a href="#cb14-135" aria-hidden="true" tabindex="-1"></a>headers <span class="op">=</span> [<span class="st">"**Username**"</span>, <span class="st">"**Counts**"</span>, <span class="st">"**Gets**"</span>, <span class="st">"**Counts / Gets**"</span>]</span>
<span id="cb14-136"><a href="#cb14-136" aria-hidden="true" tabindex="-1"></a>Markdown(pd.concat([totals.head(), totals.tail()]).to_markdown(headers<span class="op">=</span>headers))</span>
<span id="cb14-137"><a href="#cb14-137" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb14-138"><a href="#cb14-138" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb14-139"><a href="#cb14-139" aria-hidden="true" tabindex="-1"></a><span class="fu"># The Overall Counting Distribution</span></span>
<span id="cb14-140"><a href="#cb14-140" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb14-141"><a href="#cb14-141" aria-hidden="true" tabindex="-1"></a>I promised to write about a distribution of counts, and so far I've mainly written about what numbers individual counters have or have not counted. And there hasn't been a single graph yet! But I promise that's about to change. A fun thing to look at first is how many people have counted each number from 1 to 1000. It wouldn't be far-fetched to assume that each number had been counted by roughly the same amount of people, but that's not at all what happens. @fig-distribution has the details.</span>
<span id="cb14-142"><a href="#cb14-142" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb14-145"><a href="#cb14-145" aria-hidden="true" tabindex="-1"></a><span class="in">```{python}</span></span>
<span id="cb14-146"><a href="#cb14-146" aria-hidden="true" tabindex="-1"></a><span class="co">#| label: fig-distribution</span></span>
<span id="cb14-147"><a href="#cb14-147" aria-hidden="true" tabindex="-1"></a><span class="co">#| fig-cap: The amount of people who have counted each number. You can see a very sharp rise from the start of each thread to ~50, followed by a steady decline towards the get. The most popular number has been counted by more than twice as many people as the least popular.</span></span>
<span id="cb14-148"><a href="#cb14-148" aria-hidden="true" tabindex="-1"></a>aggregated <span class="op">=</span> counts.groupby(<span class="st">"position"</span>)[<span class="st">"username"</span>].nunique()</span>
<span id="cb14-149"><a href="#cb14-149" aria-hidden="true" tabindex="-1"></a>ax <span class="op">=</span> aggregated.iloc[<span class="dv">0</span>:<span class="dv">1000</span>].plot(ylabel<span class="op">=</span><span class="st">"Number of different counters"</span>, xlabel<span class="op">=</span><span class="st">"Thread position"</span>)</span>
<span id="cb14-150"><a href="#cb14-150" aria-hidden="true" tabindex="-1"></a>_ <span class="op">=</span> ax.set_xlim(<span class="op">-</span><span class="dv">5</span>, <span class="dv">1000</span>)</span>
<span id="cb14-151"><a href="#cb14-151" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb14-152"><a href="#cb14-152" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb14-153"><a href="#cb14-153" aria-hidden="true" tabindex="-1"></a>We can also look at the counting distributions for individual counters. Again, the default assumption would be that everybody has counted each number roughly the same number of times. Not too surprisingly, we see that this assumption holds better for some counters than it does for others. @fig-regularity shows the counting distributions for the most and least regular counter, and you can really see the difference between the two.</span>
<span id="cb14-154"><a href="#cb14-154" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb14-155"><a href="#cb14-155" aria-hidden="true" tabindex="-1"></a>The graph has been split into odds and evens, because there's generally a consistent difference between those two series. Intuitively, that makes sense, since most counts are made in runs where a given user makes every second counts. It's therefore not too strange that the behaviour at a value $n$ is more similar to that at $n - 2$ than at $n - 1$.</span>
<span id="cb14-156"><a href="#cb14-156" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb14-159"><a href="#cb14-159" aria-hidden="true" tabindex="-1"></a><span class="in">```{python}</span></span>
<span id="cb14-160"><a href="#cb14-160" aria-hidden="true" tabindex="-1"></a><span class="co">#| label: fig-regularity</span></span>
<span id="cb14-161"><a href="#cb14-161" aria-hidden="true" tabindex="-1"></a><span class="co">#| fig-cap: The normalized number of counts made at each value for the most and least regular counters. If every number had been counted exactly the same amount of times, there would be a flat line at y=1</span></span>
<span id="cb14-162"><a href="#cb14-162" aria-hidden="true" tabindex="-1"></a>grouped <span class="op">=</span> complete[[<span class="st">'username'</span>, <span class="st">'position'</span>]].value_counts()</span>
<span id="cb14-163"><a href="#cb14-163" aria-hidden="true" tabindex="-1"></a>cov <span class="op">=</span> grouped.groupby(level<span class="op">=</span><span class="dv">0</span>).agg(<span class="kw">lambda</span> x: np.std(x) <span class="op">/</span> np.mean(x)).sort_values()</span>
<span id="cb14-164"><a href="#cb14-164" aria-hidden="true" tabindex="-1"></a>users <span class="op">=</span> [cov.index[<span class="dv">0</span>], cov.index[<span class="op">-</span><span class="dv">1</span>]]</span>
<span id="cb14-165"><a href="#cb14-165" aria-hidden="true" tabindex="-1"></a>data <span class="op">=</span> grouped.loc[users].sort_index().to_frame().reset_index()</span>
<span id="cb14-166"><a href="#cb14-166" aria-hidden="true" tabindex="-1"></a>data.columns <span class="op">=</span> [<span class="st">'Counter'</span>, <span class="st">'Thread Position'</span>, <span class="st">'count'</span>]</span>
<span id="cb14-167"><a href="#cb14-167" aria-hidden="true" tabindex="-1"></a>data.loc[data[<span class="st">"Counter"</span>] <span class="op">==</span> users[<span class="dv">0</span>], <span class="st">'count'</span>] <span class="op">/=</span> data.loc[data[<span class="st">"Counter"</span>] <span class="op">==</span> users[<span class="dv">0</span>], <span class="st">'count'</span>].mean()</span>
<span id="cb14-168"><a href="#cb14-168" aria-hidden="true" tabindex="-1"></a>data.loc[data[<span class="st">"Counter"</span>] <span class="op">==</span> users[<span class="dv">1</span>], <span class="st">'count'</span>] <span class="op">/=</span> data.loc[data[<span class="st">"Counter"</span>] <span class="op">==</span> users[<span class="dv">1</span>], <span class="st">'count'</span>].mean()</span>
<span id="cb14-169"><a href="#cb14-169" aria-hidden="true" tabindex="-1"></a>data[<span class="st">"Parity"</span>] <span class="op">=</span> [[<span class="st">"even"</span>, <span class="st">"odd"</span>][val] <span class="cf">for</span> val <span class="kw">in</span> data.index <span class="op">%</span> <span class="dv">2</span>]</span>
<span id="cb14-170"><a href="#cb14-170" aria-hidden="true" tabindex="-1"></a>ax <span class="op">=</span> sns.lineplot(data<span class="op">=</span>data, y<span class="op">=</span><span class="st">'count'</span>, x<span class="op">=</span><span class="st">"Thread Position"</span>, hue<span class="op">=</span><span class="st">"Parity"</span>, style<span class="op">=</span><span class="st">"Counter"</span>)</span>
<span id="cb14-171"><a href="#cb14-171" aria-hidden="true" tabindex="-1"></a>_ <span class="op">=</span> ax.set_ylabel(<span class="st">"Relative frequency"</span>)</span>
<span id="cb14-172"><a href="#cb14-172" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb14-173"><a href="#cb14-173" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb14-174"><a href="#cb14-174" aria-hidden="true" tabindex="-1"></a>We can quantify the difference for each counter through the <span class="co">[</span><span class="ot">Coefficient of Variation</span><span class="co">](https://en.wikipedia.org/wiki/Coefficient_of_variation)</span>, which expresses how far their counting distribution is from uniform. Here's a table of the five most and five least regular counters:</span>
<span id="cb14-175"><a href="#cb14-175" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb14-178"><a href="#cb14-178" aria-hidden="true" tabindex="-1"></a><span class="in">```{python}</span></span>
<span id="cb14-179"><a href="#cb14-179" aria-hidden="true" tabindex="-1"></a>Markdown(pd.concat([<span class="dv">100</span><span class="op">*</span>cov.head(), <span class="dv">100</span><span class="op">*</span>cov.tail()])</span>
<span id="cb14-180"><a href="#cb14-180" aria-hidden="true" tabindex="-1"></a>         .to_markdown(headers<span class="op">=</span>[<span class="st">"**Username**"</span>, <span class="st">"**Coefficient of Variation [%]**"</span>]))</span>
<span id="cb14-181"><a href="#cb14-181" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb14-182"><a href="#cb14-182" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb14-183"><a href="#cb14-183" aria-hidden="true" tabindex="-1"></a>Of course, we saw from @fig-distribution that there's a significant variation in how many people have counted each number, so perhaps the uniform distribution is a bad model for how often we should expect each counter to have counted a particular number. Indeed, since twice as many people have counted the number 50 as have counted 1000, then **on average** people who have counted 1000 have done so twice as often as people who have counted 50. That leads to a model distribution that goes as $f(n) \propto \frac{1}{\textrm{number of people who have counted n}}$. We can again look through all the counters and see who has a counting distribution closest to this ideal:</span>
<span id="cb14-184"><a href="#cb14-184" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb14-187"><a href="#cb14-187" aria-hidden="true" tabindex="-1"></a><span class="in">```{python}</span></span>
<span id="cb14-188"><a href="#cb14-188" aria-hidden="true" tabindex="-1"></a><span class="co">#| label: fig-model</span></span>
<span id="cb14-189"><a href="#cb14-189" aria-hidden="true" tabindex="-1"></a><span class="co">#| fig-cap: The distribution of counts for the counter who most closely matches the model distribution.</span></span>
<span id="cb14-190"><a href="#cb14-190" aria-hidden="true" tabindex="-1"></a>distribution <span class="op">=</span> <span class="dv">1</span> <span class="op">/</span> aggregated.iloc[<span class="dv">0</span>:<span class="dv">1000</span>]</span>
<span id="cb14-191"><a href="#cb14-191" aria-hidden="true" tabindex="-1"></a>distribution <span class="op">=</span> distribution <span class="op">/</span> distribution.mean()</span>
<span id="cb14-192"><a href="#cb14-192" aria-hidden="true" tabindex="-1"></a>l2 <span class="op">=</span> (complete[[<span class="st">"username"</span>, <span class="st">"position"</span>]]</span>
<span id="cb14-193"><a href="#cb14-193" aria-hidden="true" tabindex="-1"></a>      .value_counts()</span>
<span id="cb14-194"><a href="#cb14-194" aria-hidden="true" tabindex="-1"></a>      .groupby(level<span class="op">=</span><span class="dv">0</span>)</span>
<span id="cb14-195"><a href="#cb14-195" aria-hidden="true" tabindex="-1"></a>      .agg(<span class="kw">lambda</span> x: ((x <span class="op">/</span> x.mean() <span class="op">-</span> distribution)<span class="op">**</span><span class="dv">2</span>).<span class="bu">sum</span>()))</span>
<span id="cb14-196"><a href="#cb14-196" aria-hidden="true" tabindex="-1"></a>username <span class="op">=</span> l2.sort_values().index[<span class="dv">0</span>]</span>
<span id="cb14-197"><a href="#cb14-197" aria-hidden="true" tabindex="-1"></a>data <span class="op">=</span> (complete[[<span class="st">'username'</span>, <span class="st">'position'</span>]]</span>
<span id="cb14-198"><a href="#cb14-198" aria-hidden="true" tabindex="-1"></a>        .value_counts()</span>
<span id="cb14-199"><a href="#cb14-199" aria-hidden="true" tabindex="-1"></a>        .loc[username]</span>
<span id="cb14-200"><a href="#cb14-200" aria-hidden="true" tabindex="-1"></a>        .sort_index()</span>
<span id="cb14-201"><a href="#cb14-201" aria-hidden="true" tabindex="-1"></a>        .to_frame()</span>
<span id="cb14-202"><a href="#cb14-202" aria-hidden="true" tabindex="-1"></a>        .reset_index())</span>
<span id="cb14-203"><a href="#cb14-203" aria-hidden="true" tabindex="-1"></a>data.columns <span class="op">=</span> [<span class="st">'Thread Position'</span>, <span class="st">'count'</span>]</span>
<span id="cb14-204"><a href="#cb14-204" aria-hidden="true" tabindex="-1"></a>data[<span class="st">'count'</span>] <span class="op">/=</span> data[<span class="st">'count'</span>].mean()</span>
<span id="cb14-205"><a href="#cb14-205" aria-hidden="true" tabindex="-1"></a>data[<span class="st">"Parity"</span>] <span class="op">=</span> [[<span class="st">"even"</span>, <span class="st">"odd"</span>][val] <span class="cf">for</span> val <span class="kw">in</span> data.index <span class="op">%</span> <span class="dv">2</span>]</span>
<span id="cb14-206"><a href="#cb14-206" aria-hidden="true" tabindex="-1"></a>ax <span class="op">=</span> sns.lineplot(data<span class="op">=</span>data, y<span class="op">=</span><span class="st">'count'</span>, x<span class="op">=</span><span class="st">"Thread Position"</span>, hue<span class="op">=</span><span class="st">"Parity"</span>, lw<span class="op">=</span><span class="dv">2</span>, linestyle<span class="op">=</span><span class="st">"--"</span>)</span>
<span id="cb14-207"><a href="#cb14-207" aria-hidden="true" tabindex="-1"></a>ax.plot(distribution, zorder<span class="op">=-</span><span class="dv">1</span>, color<span class="op">=</span><span class="st">"0.7"</span>)</span>
<span id="cb14-208"><a href="#cb14-208" aria-hidden="true" tabindex="-1"></a>ax.set_ylabel(<span class="st">"Relative Frequency"</span>)</span>
<span id="cb14-209"><a href="#cb14-209" aria-hidden="true" tabindex="-1"></a>_ <span class="op">=</span> ax.set_title(username)</span>
<span id="cb14-210"><a href="#cb14-210" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb14-211"><a href="#cb14-211" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb14-212"><a href="#cb14-212" aria-hidden="true" tabindex="-1"></a>It's impressive just how closely david's counting frequency matches the toy model I suggested above!</span>
<span id="cb14-213"><a href="#cb14-213" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb14-214"><a href="#cb14-214" aria-hidden="true" tabindex="-1"></a><span class="fu"># Odds and evens</span></span>
<span id="cb14-215"><a href="#cb14-215" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb14-216"><a href="#cb14-216" aria-hidden="true" tabindex="-1"></a>In the previous section we saw that for some counters, there's a significant difference between how they've counted the odd numbers, and how they've counted the even numbers. The difference is not unexpected, since the nature of counting means that for any given run you'll be stuck on either the odd numbers or the even numbers.</span>
<span id="cb14-217"><a href="#cb14-217" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb14-218"><a href="#cb14-218" aria-hidden="true" tabindex="-1"></a>It is striking though just how large the difference can be for some counters, so here's a table of the most odd counters, the most even counters and the most balanced counters:</span>
<span id="cb14-219"><a href="#cb14-219" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb14-222"><a href="#cb14-222" aria-hidden="true" tabindex="-1"></a><span class="in">```{python}</span></span>
<span id="cb14-223"><a href="#cb14-223" aria-hidden="true" tabindex="-1"></a><span class="co">#| label: tbl-parity</span></span>
<span id="cb14-224"><a href="#cb14-224" aria-hidden="true" tabindex="-1"></a><span class="co">#| tbl-cap: "Three sets of counters, organised by parity: Those with most odd counts, those with most even counts, and those who are closest to being perfectly balanced."</span></span>
<span id="cb14-225"><a href="#cb14-225" aria-hidden="true" tabindex="-1"></a>counts[<span class="st">"is_even"</span>] <span class="op">=</span> (counts[<span class="st">"position"</span>] <span class="op">%</span> <span class="dv">2</span> <span class="op">==</span> <span class="dv">0</span>)</span>
<span id="cb14-226"><a href="#cb14-226" aria-hidden="true" tabindex="-1"></a>offsets <span class="op">=</span> [<span class="st">"1gm10t"</span>, <span class="st">"7hn2tm"</span>, <span class="st">"b471wg"</span>, <span class="st">"bz6r0g"</span>, <span class="st">"d6pgni"</span>, <span class="st">"ebnh39"</span>, <span class="st">"grggc0"</span>, <span class="st">"oj50hj"</span>, <span class="st">"ob4a2h"</span>, <span class="st">"t81gug"</span>]</span>
<span id="cb14-227"><a href="#cb14-227" aria-hidden="true" tabindex="-1"></a><span class="cf">for</span> offset <span class="kw">in</span> offsets:</span>
<span id="cb14-228"><a href="#cb14-228" aria-hidden="true" tabindex="-1"></a>    counts.loc[counts[<span class="st">"submission_id"</span>] <span class="op">==</span> offset, <span class="st">'is_even'</span>] <span class="op">=</span> <span class="dv">1</span> <span class="op">-</span> counts.loc[counts[<span class="st">"submission_id"</span>] <span class="op">==</span> offset, <span class="st">'is_even'</span>]</span>
<span id="cb14-229"><a href="#cb14-229" aria-hidden="true" tabindex="-1"></a>counts[<span class="st">'is_odd'</span>] <span class="op">=</span> <span class="dv">1</span> <span class="op">-</span> counts[<span class="st">'is_even'</span>]</span>
<span id="cb14-230"><a href="#cb14-230" aria-hidden="true" tabindex="-1"></a>subset <span class="op">=</span> counts.query(<span class="st">"username in @usernames"</span>)</span>
<span id="cb14-231"><a href="#cb14-231" aria-hidden="true" tabindex="-1"></a>table <span class="op">=</span> subset[[<span class="st">'username'</span>, <span class="st">'is_even'</span>, <span class="st">'is_odd'</span>]].groupby(<span class="st">'username'</span>).<span class="bu">sum</span>()</span>
<span id="cb14-232"><a href="#cb14-232" aria-hidden="true" tabindex="-1"></a>table.columns<span class="op">=</span>[<span class="st">"n_even"</span>, <span class="st">"n_odd"</span>]</span>
<span id="cb14-233"><a href="#cb14-233" aria-hidden="true" tabindex="-1"></a>table[<span class="st">'difference'</span>] <span class="op">=</span> table[<span class="st">'n_even'</span>] <span class="op">-</span> table[<span class="st">'n_odd'</span>]</span>
<span id="cb14-234"><a href="#cb14-234" aria-hidden="true" tabindex="-1"></a>table[<span class="st">'relative_difference'</span>] <span class="op">=</span> (table[<span class="st">'n_even'</span>] <span class="op">-</span> table[<span class="st">'n_odd'</span>]) <span class="op">/</span> (table[<span class="st">'n_even'</span>] <span class="op">+</span> table[<span class="st">'n_odd'</span>]) <span class="op">*</span> <span class="dv">100</span></span>
<span id="cb14-235"><a href="#cb14-235" aria-hidden="true" tabindex="-1"></a>table[<span class="st">'absolute_difference'</span>] <span class="op">=</span> <span class="bu">abs</span>(table[<span class="st">'relative_difference'</span>])</span>
<span id="cb14-236"><a href="#cb14-236" aria-hidden="true" tabindex="-1"></a>headers<span class="op">=</span>[<span class="st">"**Username**"</span>, <span class="st">"**n_(even)**"</span>, <span class="st">"**n_(odd)**"</span>, <span class="st">"**Difference**"</span>, <span class="st">"**Relative Difference [%]**"</span>]</span>
<span id="cb14-237"><a href="#cb14-237" aria-hidden="true" tabindex="-1"></a>columns <span class="op">=</span> [<span class="st">'n_even'</span>, <span class="st">'n_odd'</span>, <span class="st">'difference'</span>, <span class="st">'relative_difference'</span>]</span>
<span id="cb14-238"><a href="#cb14-238" aria-hidden="true" tabindex="-1"></a>Markdown(pd.concat([table.sort_values(by<span class="op">=</span><span class="st">'difference'</span>).head(),</span>
<span id="cb14-239"><a href="#cb14-239" aria-hidden="true" tabindex="-1"></a>                    table.sort_values(by<span class="op">=</span><span class="st">'difference'</span>, ascending<span class="op">=</span><span class="va">False</span>).head(),</span>
<span id="cb14-240"><a href="#cb14-240" aria-hidden="true" tabindex="-1"></a>                    table.sort_values(by<span class="op">=</span><span class="st">'absolute_difference'</span>).head()])[columns]</span>
<span id="cb14-241"><a href="#cb14-241" aria-hidden="true" tabindex="-1"></a>         .to_markdown(headers<span class="op">=</span>headers))</span>
<span id="cb14-242"><a href="#cb14-242" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb14-243"><a href="#cb14-243" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb14-244"><a href="#cb14-244" aria-hidden="true" tabindex="-1"></a>That's all for now!</span>
</code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div></div></div></div></div>
</div> <!-- /content -->
<footer class="footer">
  <div class="nav-footer">
      <div class="nav-footer-center">
        <ul class="footer-items list-unstyled">
    <li class="nav-item">
    <a class="nav-link" href="./about.html">About</a>
  </li>  
    <li class="nav-item">
    <a class="nav-link" href="https://github.com/cutonbuminband/rcounting">Github</a>
  </li>  
</ul>
      </div>
  </div>
</footer>



</body></html>